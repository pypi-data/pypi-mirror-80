function u(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),i.push.apply(i,s)}return i}function h(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?u(Object(i),!0).forEach(function(s){r(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}export class AudioPlayer{get current(){return this.playing?this.context.currentTime-this.startAt+this.offset:this.offset}get duration(){return this.buffer?this.buffer.duration:Number.NaN}get sampleRate(){return this.buffer?this.decodedSampleRate:Number.NaN}get volumn(){return this.gain.gain.value*100}set volumn(t){t>100?t=100:t<0&&(t=0),this.gain.gain.value=t/100}constructor(t){var e;r(this,"context",void 0),r(this,"gain",void 0),r(this,"source",null),r(this,"buffer",null),r(this,"decodedSampleRate",Number.NaN),r(this,"contextFromOptions",void 0),r(this,"startAt",0),r(this,"stopAt",0),r(this,"offset",0),r(this,"toggleVolumn",100),r(this,"playing",!1),r(this,"options",void 0),this.options=h({context:(e=t==null?void 0:t.context)!==null&&e!==void 0?e:new AudioContext,volumn:100,onplay:()=>{},onstop:()=>{}},t),this.contextFromOptions=!!(t==null?void 0:t.context),this.context=this.options.context,this.gain=this.context.createGain(),this.volumn=this.options.volumn}reset(){if(this.buffer){if(this.playing){var t;(t=this.source)===null||t===void 0||t.stop(0)}this.startAt=0,this.stopAt=0,this.offset=0,this.buffer=null}}static getWavSampleRate(t){const e=new Int8Array(t),i=e.slice(24,28);return i[0]&255|(i[1]&255)<<8|(i[2]&255)<<16|(i[3]&255)<<24}static getMp3SampleRate(t){let e=new Uint8Array(t);if(String.fromCharCode.apply(null,Array.from(e.slice(0,3)))==="ID3"){e=e.slice(10);let l=0;for(;e[l]!==0;){const a=e[l+4]*4294967296+e[l+5]*65536+e[l+6]*256+e[l+7];l+=10+a}}let i=0;for(;e[i++]!==255;);i--;const s=e.slice(i,i+4),o=(s[1]&24)>>3,n=(s[2]&12)>>2;if(o===3){if(n===0)return 44100;if(n===1)return 48e3;if(n===2)return 32e3}else if(o===2){if(n===0)return 22050;if(n===1)return 24e3;if(n===2)return 16e3}else if(o===0){if(n===0)return 11025;if(n===1)return 12e3;if(n===2)return 8e3}return Number.NaN}load(t,e){return this.reset(),e==="wav"?this.decodedSampleRate=AudioPlayer.getWavSampleRate(t):e==="mpga"||e==="mp3"?this.decodedSampleRate=AudioPlayer.getMp3SampleRate(t):this.decodedSampleRate=Number.NaN,new Promise((i,s)=>{this.context.decodeAudioData(t,o=>{this.buffer=o,i()},s)})}play(){if(!this.buffer)throw new Error("No audio loaded");this.source=this.context.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(this.gain).connect(this.context.destination),this.source.addEventListener("ended",()=>{this.stopAt=this.context.currentTime,this.offset+=this.stopAt-this.startAt,this.playing=!1,this.options.onstop(),this.source=null}),this.offset>=this.duration&&(this.offset=0),this.source.start(0,this.offset),this.startAt=this.context.currentTime,this.playing=!0,this.options.onplay()}pause(){var t;if(!this.buffer)throw new Error("No audio loaded");(t=this.source)===null||t===void 0||t.stop(0)}toggle(){this.playing?this.pause():this.play()}stop(){this.pause(),this.startAt=0,this.stopAt=0,this.offset=0}seek(t){if(t!=null&&(t<0||t>this.duration))throw new Error("Invalid offset");this.offset=t}toggleMute(){this.volumn===0?this.volumn=this.toggleVolumn||100:(this.toggleVolumn=this.volumn,this.volumn=0)}dispose(){this.reset(),this.contextFromOptions||this.context.close(),this.source=null,this.buffer=null}}
