const f={};import g from"../../__snowpack__/env.js";f.env=g;function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?O(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(e,t){if(e==null)return{};var n=b(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++){if(r=o[a],t.indexOf(r)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,r))continue;n[r]=e[r]}}return n}function b(e,t){if(e==null)return{};var n={},r=Object.keys(e),a,o;for(o=0;o<r.length;o++){if(a=r[o],t.indexOf(a)>=0)continue;n[a]=e[a]}return n}import v from"../../web_modules/i18next.js";import E from"../../web_modules/query-string.js";const l=f.env.SNOWPACK_PUBLIC_API_TOKEN_KEY,j=f.env.SNOWPACK_PUBLIC_API_URL,h="X-VisualDL-Instance-ID",p=l?E.parse(window.location.search)[l]:"";export function getApiToken(){return p!=null?p:null}function A(e){const t=getApiToken();if(!l||!t)return e;const n=e||{},{headers:r}=n,a=P(n,["headers"]),o=new Headers(r);return Array.isArray(t)?t.forEach(i=>o.append(h,i)):o.append(h,t),m(m({},a),{},{headers:o})}function I(){return new Promise(e=>{v.changeLanguage(void 0).then(t=>e(t))})}function c(e){return f.env.MODE==="development"&&console.error(e),I()}export async function fetcher(e,t){var n;let r;try{r=await fetch(j+e,A(t))}catch(o){const i=await c(o);throw new Error(i("errors:network-error"))}if(!r.ok){const o=await c(r);throw new Error(o([`errors:response-error.${r.status}`,"errors:response-error.unknown"]))}let a;if((n=r.headers.get("content-type"))===null||n===void 0?void 0:n.includes("application/json")){try{a=await r.json()}catch(o){const i=await c(o);throw new Error(i("errors:parse-error"))}if(a&&"status"in a)if(a.status!==0){const o=await c(a);throw new Error(a.msg||o("errors:error"))}else return a.data;return a}else{let o;try{o=await r.blob()}catch(s){const u=await c(s);throw new Error(u("errors:parse-error"))}const i=r.headers.get("Content-Disposition");o.arrayBuffer||(o.arrayBuffer=async()=>new Promise((s,u)=>{const w=new FileReader;w.addEventListener("load",y=>y.target?s(y.target.result):u()),w.readAsArrayBuffer(o)}));let d=null;if(i&&i.indexOf("attachment")!==-1){const s=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(i);s!=null&&s[1]&&(d=s[1].replace(/['"]/g,""))}return{data:o,type:r.headers.get("Content-Type"),filename:d}}}export const cycleFetcher=async(e,t)=>await Promise.all(e.map(n=>fetcher(n,t)));
