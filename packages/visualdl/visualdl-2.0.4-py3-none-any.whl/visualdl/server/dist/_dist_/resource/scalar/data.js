import h from"../../../web_modules/bignumberjs.js";import N from"../../../web_modules/lodash/compact.js";import b from"../../../web_modules/lodash/maxBy.js";import f from"../../../web_modules/lodash/minBy.js";import{quantile as p}from"../../utils/index.js";export const transform=({datasets:n,smoothing:o})=>n.map(t=>{const i=t.map(a=>[...a,Number.NaN,Number.NaN]);let r=new h(i.length>0?0:Number.NaN),e=0,l=0;const m=new h(o);return i.forEach((a,u)=>{const s=new h(a[2]),g=a[0]=Math.floor(a[0]);if(u===0&&(l=g),a[4]=Math.floor(g-l)/(60*60*1e3),!s.isFinite())a[3]=s.toNumber();else{r=r.multipliedBy(m).plus(m.minus(1).negated().multipliedBy(s)),e++;let d=new h(1);m.isEqualTo(1)||(d=m.exponentiatedBy(e).minus(1).negated()),a[3]=r.dividedBy(d).toNumber()}}),i}),singlePointRange=n=>({min:n?Math.min(n*2,0):-.5,max:n?Math.max(n*2,0):.5}),range=({datasets:n})=>n==null?void 0:n.map(o=>{var t,i;if(o.length==0)return{min:Number.NaN,max:Number.NaN};const r=o.map(e=>e[2]);return{min:(t=Math.min(...r))!==null&&t!==void 0?t:Number.NaN,max:(i=Math.max(...r))!==null&&i!==void 0?i:Number.NaN}}),axisRange=({datasets:n,outlier:o})=>{var t,i,r,e;const l=N(n==null?void 0:n.map(u=>{if(u.length==0)return;const s=u.map(c=>c[2]);if(o){const c=u.map(x=>x[2]).sort();return{min:p(c,.05),max:p(s,.95)}}else{var g,d;return{min:(g=Math.min(...s))!==null&&g!==void 0?g:0,max:(d=Math.max(...s))!==null&&d!==void 0?d:0}}})),m=(t=(i=f(l,u=>u.min))===null||i===void 0?void 0:i.min)!==null&&t!==void 0?t:0,a=(r=(e=b(l,u=>u.max))===null||e===void 0?void 0:e.max)!==null&&r!==void 0?r:0;if(!(m===0&&a===0))return{min:m>0?m*.9:m*1.1,max:a>0?a*1.1:a*.9}},nearestPoint=(n,o,t)=>n.map((i,r)=>{let e;if(t===0)e=i[0];else for(let l=0;l<i.length;l++){const m=i[l];if(m[1]===t){e=m;break}if(m[1]>t){e=i[l-1>=0?l-1:0];break}e||(e=i[i.length-1])}return{run:o[r],item:e||[0,0,0,0,0]}}),parseSmoothing=n=>{const o=Number.parseFloat(String(n));let t=.6;return Number.isFinite(o)&&o<1&&o>=0&&(t=Math.round(o*100)/100),t};
