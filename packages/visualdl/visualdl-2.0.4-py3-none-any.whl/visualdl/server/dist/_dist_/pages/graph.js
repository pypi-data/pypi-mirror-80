import j,{AsideSection as s}from"../components/Aside.js";import se from"../components/GraphPage/Graph.js";import e,{useCallback as i,useEffect as H,useMemo as x,useRef as q,useState as r}from"../../web_modules/react.js";import ie from"../components/Select.js";import{actions as ce,selectors as _e}from"../store/index.js";import{primaryColor as me,rem as c,size as pe}from"../utils/style.js";import{useDispatch as de,useSelector as ue}from"../../web_modules/react-redux.js";import y from"../components/Button.js";import D from"../components/Checkbox.js";import he from"../components/Content.js";import f from"../components/Field.js";import Ee from"../../web_modules/react-spinners/HashLoader.js";import ge from"../components/GraphPage/ModelPropertiesDialog.js";import fe from"../components/GraphPage/NodeDocumentationSidebar.js";import Pe from"../components/GraphPage/NodePropertiesSidebar.js";import J from"../components/RadioButton.js";import Re from"../components/RadioGroup.js";import ve from"../components/GraphPage/Search.js";import Ue from"../components/Title.js";import we from"../components/GraphPage/Uploader.js";import _ from"../../web_modules/styled-components.js";import Se from"../hooks/useRequest.js";import{useTranslation as Ce}from"../../web_modules/react-i18next.js";const K=_(y).withConfig({displayName:"graph__FullWidthButton",componentId:"sc-1v5tw03-0"})(["width:100%;"]),be=_(ie).withConfig({displayName:"graph__FullWidthSelect",componentId:"sc-1v5tw03-1"})(["width:100%;"]),je=_.div.withConfig({displayName:"graph__ExportButtonWrapper",componentId:"sc-1v5tw03-2"})(["display:flex;justify-content:space-between;> *{flex:1 1 auto;&:not(:last-child){margin-right:",";}}"],c(20)),xe=_(s).withConfig({displayName:"graph__SearchSection",componentId:"sc-1v5tw03-3"})(["max-height:calc(100% - ",");display:flex;flex-direction:column;&:not(:last-child){padding-bottom:0;}"],c(40)),ye=_.div.withConfig({displayName:"graph__Loading",componentId:"sc-1v5tw03-4"})([""," display:flex;flex-direction:column;justify-content:center;align-items:center;overscroll-behavior:none;cursor:progress;font-size:",";line-height:",";"],pe("100%","100%"),c(16),c(60)),De=()=>{const{t:n}=Ce(["graph","common"]),N=de(),Q=ue(_e.graph.model),l=q(null),m=q(null),[P,R]=r(Q),p=i(()=>{m.current&&(m.current.value="",m.current.click())},[]),V=i(t=>{const o=t.target;o&&o.files&&o.files.length&&(N(ce.graph.setModel(o.files)),R(o.files))},[N]),{data:a,loading:v}=Se(P?null:"/graph/graph");H(()=>{(a==null?void 0:a.data.size)&&R([new File([a.data],a.filename||"unknwon_model")])},[a]);const[U,X]=r([]),[G,F]=r(""),Y=i(t=>{X(t.graphs),F(t.selected||"")},[]),k=i(t=>{var o;F(t),(o=l.current)===null||o===void 0||o.changeGraph(t)},[]),[z,w]=r(""),[d,M]=r(!1),[B,I]=r({text:"",result:[]}),A=i(t=>{var o;w(t),(o=l.current)===null||o===void 0||o.search(t)},[]),$=i(t=>{var o;w(t.name),(o=l.current)===null||o===void 0||o.select(t)},[]),[u,Z]=r(!1),[h,ee]=r(!0),[E,te]=r(!1),[S,oe]=r(!1),[ne,W]=r(null),[g,L]=r(null),[C,b]=r(null);H(()=>{w(""),I({text:"",result:[]})},[P,u,h,E]);const O=x(()=>d?null:e.createElement(K,{type:"primary",rounded:!0,onClick:p},n("graph:change-model")),[n,p,d]),[T,re]=r(!1),le=x(()=>!T||v?null:C?e.createElement(j,{width:c(360)},e.createElement(fe,{data:C,onClose:()=>b(null)})):g?e.createElement(j,{width:c(360)},e.createElement(Pe,{data:g,onClose:()=>L(null),showNodeDodumentation:()=>{var t;return(t=l.current)===null||t===void 0?void 0:t.showNodeDocumentation(g)}})):e.createElement(j,{bottom:O},e.createElement(xe,null,e.createElement(ve,{text:z,data:B,onChange:A,onSelect:$,onActive:()=>M(!0),onDeactive:()=>M(!1)})),!d&&e.createElement(e.Fragment,null,e.createElement(s,null,e.createElement(K,{onClick:()=>{var t;return(t=l.current)===null||t===void 0?void 0:t.showModelProperties()}},n("graph:model-properties"))),U.length>1&&e.createElement(s,null,e.createElement(f,{label:n("graph:subgraph")},e.createElement(be,{list:U,value:G,onChange:k}))),e.createElement(s,null,e.createElement(f,{label:n("graph:display-data")},e.createElement("div",null,e.createElement(D,{value:u,onChange:Z},n("graph:show-attributes"))),e.createElement("div",null,e.createElement(D,{value:h,onChange:ee},n("graph:show-initializers"))),e.createElement("div",null,e.createElement(D,{value:E,onChange:te},n("graph:show-node-names"))))),e.createElement(s,null,e.createElement(f,{label:n("graph:direction")},e.createElement(Re,{value:S,onChange:oe},e.createElement(J,{value:!1},n("graph:vertical")),e.createElement(J,{value:!0},n("graph:horizontal"))))),e.createElement(s,null,e.createElement(f,{label:n("graph:export-file")},e.createElement(je,null,e.createElement(y,{onClick:()=>{var t;return(t=l.current)===null||t===void 0?void 0:t.export("png")}},n("graph:export-png")),e.createElement(y,{onClick:()=>{var t;return(t=l.current)===null||t===void 0?void 0:t.export("svg")}},n("graph:export-svg"))))))),[n,O,z,d,B,U,G,k,A,$,u,h,E,S,T,v,g,C]),ae=x(()=>e.createElement(we,{onClickUpload:p,onDropFiles:R}),[p]);return e.createElement(e.Fragment,null,e.createElement(Ue,null,n("common:graph")),e.createElement(ge,{data:ne,onClose:()=>W(null)}),e.createElement(he,{aside:le},v?e.createElement(ye,null,e.createElement(Ee,{size:"60px",color:me})):e.createElement(se,{ref:l,files:P,uploader:ae,showAttributes:u,showInitializers:h,showNames:E,horizontal:S,onRendered:()=>re(!0),onOpened:Y,onSearch:t=>I(t),onShowModelProperties:t=>W(t),onShowNodeProperties:t=>{L(t),b(null)},onShowNodeDocumentation:t=>b(t)}),e.createElement("input",{ref:m,type:"file",multiple:!1,onChange:V,style:{display:"none"}})))};export default De;
