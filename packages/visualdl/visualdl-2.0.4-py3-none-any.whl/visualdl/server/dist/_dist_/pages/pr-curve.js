function P(){return P=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},P.apply(this,arguments)}function k(e,t){if(e==null)return{};var n=q(e,t),r,i;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(i=0;i<p.length;i++){if(r=p[i],t.indexOf(r)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,r))continue;n[r]=e[r]}}return n}function q(e,t){if(e==null)return{};var n={},r=Object.keys(e),i,p;for(p=0;p<r.length;p++){if(i=r[p],t.indexOf(i)>=0)continue;n[i]=e[i]}return n}function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?T(Object(n),!0).forEach(function(r){A(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}import D from"../components/ChartPage.js";import a,{useCallback as x,useEffect as M,useMemo as j,useState as y}from"../../web_modules/react.js";import{rem as U,transitionProps as K}from"../utils/style.js";import{AsideSection as E}from"../components/Aside.js";import L from"../components/Content.js";import N from"../components/Error.js";import z from"../components/Field.js";import B from"../components/PRCurvePage/PRCurveChart.js";import G from"../components/RunAside.js";import H from"../components/PRCurvePage/StepSlider.js";import J from"../components/TimeModeSelect.js";import{TimeType as Q}from"../resource/pr-curve/index.js";import V from"../components/Title.js";import{cycleFetcher as X}from"../utils/fetch.js";import Y from"../../web_modules/query-string.js";import Z from"../../web_modules/styled-components.js";import{useRunningRequest as ee}from"../hooks/useRequest.js";import te from"../hooks/useTagFilter.js";import{useTranslation as re}from"../../web_modules/react-i18next.js";const ne=Z.div.withConfig({displayName:"pr-curve__StepSliderWrapper",componentId:"sc-2ui709-0"})(["max-height:30vh;overflow:auto;overflow-x:hidden;overflow-y:auto;flex-shrink:0;> ",":last-child{padding-bottom:",";margin-bottom:0;}+ .run-section{border-top:1px solid var(--border-color);margin-top:0;padding-top:",";","}&:empty + .run-section{border-top:none;}"],E,U(20),U(20),K("border-color")),oe=()=>{const{t:e}=re(["pr-curve","common"]),[t,n]=y(!0),{runs:r,tags:i,runsInTags:p,selectedRuns:R,onChangeRuns:O,loading:_}=te("pr-curve",t),[w,C]=y({}),S=x((o,l)=>C(u=>m(m({},u),{},{[o]:l})),[]);M(()=>C(o=>p.reduce((l,u)=>(o[u.label]!=null&&(l[u.label]=o[u.label]),l),{})),[p]);const{data:s}=ee(p.map(o=>`/pr-curve/steps?${Y.stringify({run:o.label})}`),!!t,(...o)=>X(o)),d=j(()=>p.map((o,l)=>{var u,c,v,b,h;return m(m({},o),{},{index:(u=w[o.label])!==null&&u!==void 0?u:((c=s==null?void 0:s[l].length)!==null&&c!==void 0?c:1)-1,steps:(v=s==null?void 0:s[l].map(f=>f[1]))!==null&&v!==void 0?v:[],wallTimes:(b=s==null?void 0:s[l].map(f=>Math.floor(f[0])))!==null&&b!==void 0?b:[],relatives:(h=s==null?void 0:s[l].map(f=>f[0]-s[l][0][0]))!==null&&h!==void 0?h:[]})}),[p,s,w]),[g,I]=y(Q.Step),$=j(()=>i.map(o=>m(m({},o),{},{runs:o.runs.map(l=>m(m({},l),{},{index:0,steps:[],wallTimes:[],relatives:[]},d.find(u=>u.label===l.label)))})),[i,d]),F=j(()=>r.length?a.createElement(G,{runs:r,selectedRuns:R,onChangeRuns:O,running:t,onToggleRunning:n},a.createElement(E,null,a.createElement(z,{label:e("pr-curve:time-display-type")},a.createElement(J,{value:g,onChange:I}))),a.createElement(ne,null,d.map(o=>a.createElement(E,{key:o.label},a.createElement(H,{run:o,type:g,onChange:l=>S(o.label,l)}))))):null,[e,O,t,r,R,g,d,S]),W=x(o=>{let{label:l,runs:u}=o,c=k(o,["label","runs"]);return a.createElement(B,P({runs:u,tag:l},c,{running:t}))},[t]);return a.createElement(a.Fragment,null,a.createElement(V,null,e("common:pr-curve")),a.createElement(L,{aside:F,loading:_},!_&&!r.length?a.createElement(N,null):a.createElement(D,{items:$,withChart:W,loading:_})))};export default oe;
