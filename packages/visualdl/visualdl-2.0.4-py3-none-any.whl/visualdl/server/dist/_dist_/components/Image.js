import t,{useImperativeHandle as _,useLayoutEffect as c,useState as p}from"../../web_modules/react.js";import{primaryColor as R}from"../utils/style.js";import j from"../../web_modules/react-spinners/GridLoader.js";import{fetcher as v}from"../utils/fetch.js";import U from"../../web_modules/mime-types.js";import{saveAs as E}from"../../web_modules/file-saver.js";import b from"../hooks/useRequest.js";import{useTranslation as L}from"../../web_modules/react-i18next.js";const y=t.forwardRef(({src:o,cache:s,className:m},a)=>{const{t:i}=L("common"),[n,u]=p(""),{data:e,error:d,loading:f}=b(o!=null?o:null,v,{dedupingInterval:s!=null?s:2e3});return _(a,()=>({save:r=>{if(e){const l=e.type?U.extension(e.type):null;E(e.data,r.replace(/[/\\?%*:|"<>]/g,"_")+(l?`.${l}`:""))}}})),c(()=>{if(e){let r=null;return r=URL.createObjectURL(e.data),u(r),()=>{r&&URL.revokeObjectURL(r)}}},[e]),f?t.createElement(j,{color:R,size:"10px"}):d?t.createElement("div",null,i("common:error")):t.createElement("img",{className:m,src:n})});export default y;
