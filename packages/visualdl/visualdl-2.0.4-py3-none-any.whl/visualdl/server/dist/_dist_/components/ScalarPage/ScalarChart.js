function L(r,t){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(r,c).enumerable})),a.push.apply(a,n)}return a}function i(r){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?L(Object(a),!0).forEach(function(n){ne(r,n,a[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):L(Object(a)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(a,n))})}return r}function ne(r,t,a){return t in r?Object.defineProperty(r,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[t]=a,r}import se,{XAxisType as d,YAxisType as h}from"../LineChart.js";import f,{useCallback as w,useMemo as l,useRef as ie,useState as q}from"../../../web_modules/react.js";import{XAxis as le,axisRange as ce,chartData as me,options as N,nearestPoint as ue,range as pe,singlePointRange as $,sortingMethodMap as de,tooltip as fe,transform as ge,xAxisMap as ye}from"../../resource/scalar/index.js";import{rem as j,size as Y}from"../../utils/style.js";import he from"../ChartToolbox.js";import _e from"../TooltipTable.js";import{cycleFetcher as ve}from"../../utils/fetch.js";import be from"../../utils/event.js";import{format as xe}from"../../../web_modules/d3-format.js";import we from"../../../web_modules/query-string.js";import{renderToStaticMarkup as je}from"../../../web_modules/react-dom/server.js";import _ from"../../../web_modules/styled-components.js";import P from"../../hooks/useHeavyWork.js";import{useRunningRequest as Pe}from"../../hooks/useRequest.js";import{useTranslation as Ce}from"../../../web_modules/react-i18next.js";import C from"../../utils/wasm.js";const Oe=xe(".8"),Te=()=>C("scalar_transform").then(r=>t=>r(t.datasets,t.smoothing)),Re=()=>C("scalar_axis_range").then(r=>t=>r(t.datasets,t.outlier)),ke=()=>C("scalar_range").then(r=>t=>r(t.datasets)),Se=_.div.withConfig({displayName:"ScalarChart__Wrapper",componentId:"sc-1caty5y-0"})([""," display:flex;flex-direction:column;align-items:stretch;justify-content:space-between;"],Y("100%","100%")),Ee=_(se).withConfig({displayName:"ScalarChart__StyledLineChart",componentId:"sc-1caty5y-1"})(["flex-grow:1;"]),We=_(he).withConfig({displayName:"ScalarChart__Toolbox",componentId:"sc-1caty5y-2"})(["margin-left:",";margin-right:",";margin-bottom:",";"],j(20),j(20),j(18)),ze=_.div.withConfig({displayName:"ScalarChart__Error",componentId:"sc-1caty5y-3"})([""," display:flex;justify-content:center;align-items:center;"],Y("100%","100%")),Ae=({cid:r,runs:t,tag:a,smoothing:n,xAxis:c,sortingMethod:O,outlier:T,smoothedOnly:R,showMostValue:k,running:F})=>{const{t:m,i18n:S}=Ce(["scalar","common"]),v=ie(null),{data:g,error:H,loading:X}=Pe(t.map(e=>`/scalar/list?${we.stringify({run:e.label,tag:a})}`),!!F,(...e)=>ve(e)),[E,K]=q(!1),B=w(()=>{be.emit("toggle-chart-size",r,!E),K(e=>!e)},[r,E]),p=l(()=>c===le.WallTime?d.time:d.value,[c]),[W,z]=q(h.value),G=w(()=>{z(e=>e===h.log?h.value:h.log)},[z]),J=l(()=>{var e;return{datasets:(e=g==null?void 0:g.map(s=>s!=null?s:[]))!==null&&e!==void 0?e:[],smoothing:n}},[g,n]),y=P(Te,null,ge,J),o=l(()=>y!=null?y:[],[y]),Q=l(()=>({datasets:o,outlier:!!T}),[o,T]),A=P(Re,null,ce,Q),Z=l(()=>({datasets:o}),[o]),u=P(ke,null,pe,Z),b=l(()=>{let e,s=A;return o.length===1&&o[0].length===1&&([d.value,d.log].includes(p)&&(e=$(o[0][0][ye[c]])),s=$(o[0][0][2])),{x:e,y:s}},[o,A,p,c]),D=l(()=>me({data:o.slice(0,t.length),ranges:k?u!=null?u:[]:[],runs:t,xAxis:c,smoothedOnly:R}),[o,u,t,c,R,k]),M=l(()=>String(Math.max(...o.map(e=>Math.max(...e.map(s=>s[1]))))).length,[o]),I=w(e=>{const s=Array.isArray(e)?e[0].data:e.data,ee=ue(o!=null?o:[],t,s[1]).map((x,ae)=>i(i({},x),u==null?void 0:u[ae])),te=de[O],U=te(ee,s),{columns:re,data:oe}=fe(U,M,S);return je(f.createElement(_e,{run:m("common:runs"),runs:U.map(x=>x.run),columns:re,data:oe}))},[o,u,t,O,M,m,S]),V=l(()=>i(i({},N),{},{tooltip:i(i({},N.tooltip),{},{formatter:I,hideDelay:300,enterable:!0}),xAxis:i(i({type:p},b.x),{},{axisPointer:{label:{formatter:p===d.time?void 0:({value:e})=>Oe(e)}}}),yAxis:i({type:W},b.y)}),[I,b,p,W]);return!D&&H?f.createElement(ze,null,m("common:error")):f.createElement(Se,null,f.createElement(Ee,{ref:v,title:a,options:V,data:D,loading:X,zoom:!0}),f.createElement(We,{items:[{icon:"maximize",activeIcon:"minimize",tooltip:m("scalar:maximize"),activeTooltip:m("scalar:minimize"),toggle:!0,onClick:B},{icon:"restore-size",tooltip:m("scalar:restore"),onClick:()=>{var e;return(e=v.current)===null||e===void 0?void 0:e.restore()}},{icon:"log-axis",tooltip:m("scalar:toggle-log-axis"),toggle:!0,onClick:G},{icon:"download",tooltip:m("scalar:download-image"),onClick:()=>{var e;return(e=v.current)===null||e===void 0?void 0:e.saveAsImage()}}]}))};export default Ae;
