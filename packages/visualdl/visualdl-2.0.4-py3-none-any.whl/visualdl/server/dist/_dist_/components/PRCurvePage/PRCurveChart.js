function x(r,t){var n=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(r,o).enumerable})),n.push.apply(n,i)}return n}function f(r){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?x(Object(n),!0).forEach(function(i){F(r,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(n,i))})}return r}function F(r,t,n){return t in r?Object.defineProperty(r,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[t]=n,r}import W from"../LineChart.js";import u,{useCallback as O,useMemo as y,useRef as K,useState as B}from"../../../web_modules/react.js";import{options as R,nearestPoint as G}from"../../resource/pr-curve/index.js";import{rem as j,size as z}from"../../utils/style.js";import H from"../ChartToolbox.js";import J from"../TooltipTable.js";import{cycleFetcher as Q}from"../../utils/fetch.js";import V from"../../utils/event.js";import{format as E}from"../../../web_modules/d3-format.js";import X from"../../../web_modules/query-string.js";import{renderToStaticMarkup as Y}from"../../../web_modules/react-dom/server.js";import v from"../../../web_modules/styled-components.js";import{useRunningRequest as Z}from"../../hooks/useRequest.js";import{useTranslation as ee}from"../../../web_modules/react-i18next.js";import te from"../../../web_modules/lodash/zip.js";const T=E(".4f"),re=E(".2f"),oe=v.div.withConfig({displayName:"PRCurveChart__Wrapper",componentId:"b2l3cc-0"})([""," display:flex;flex-direction:column;align-items:stretch;justify-content:space-between;"],z("100%","100%")),ne=v(W).withConfig({displayName:"PRCurveChart__StyledLineChart",componentId:"b2l3cc-1"})(["flex-grow:1;"]),ie=v(H).withConfig({displayName:"PRCurveChart__Toolbox",componentId:"b2l3cc-2"})(["margin-left:",";margin-right:",";margin-bottom:",";"],j(20),j(20),j(18)),le=v.div.withConfig({displayName:"PRCurveChart__Error",componentId:"b2l3cc-3"})([""," display:flex;justify-content:center;align-items:center;"],z("100%","100%")),ae=({cid:r,runs:t,tag:n,running:i})=>{const{t:o}=ee(["pr-curve","common"]),b=K(null),{data:p,error:S,loading:D}=Z(t.map(e=>`/pr-curve/list?${X.stringify({run:e.label,tag:n})}`),!!i,(...e)=>Q(e)),[w,I]=B(!1),$=O(()=>{V.emit("toggle-chart-size",r,!w),I(e=>!e)},[r,w]),d=y(()=>t.map((e,s)=>{var l,c;const[_,h,...a]=(l=p==null||((c=p[s])===null||c===void 0)?void 0:c.find(m=>m[1]===e.steps[e.index]))!==null&&l!==void 0?l:[0,0,[],[],[],[],[],[],[]];return[_,h,te(...a)]}),[p,t]),C=y(()=>d.map((e,s)=>{const l=t[s];return{name:l.label,z:s,itemStyle:{color:l.colors[0]},lineStyle:{color:l.colors[0]},data:e[2],encode:{x:[1],y:[0]}}}),[d,t]),P=O(e=>{const s=Array.isArray(e)?e[0].data:e.data,l=G(d.map(a=>a[2]),s[1]),c=[{label:o("pr-curve:threshold")},{label:o("pr-curve:precision")},{label:o("pr-curve:recall")},{label:o("pr-curve:true-positives")},{label:o("pr-curve:false-positives")},{label:o("pr-curve:true-negatives")},{label:o("pr-curve:false-negatives")}],_=l.reduce((a,m,g)=>(a.push(...new Array(m.length).fill(t[g])),a),[]),h=l.reduce((a,m)=>(a.push(...m.map(([g,k,q,A,L,M,N])=>[re(N),T(g),T(k),q,A,L,M])),a),[]);return Y(u.createElement(J,{run:o("common:runs"),runs:_,columns:c,data:h}))},[d,t,o]),U=y(()=>f(f({},R),{},{tooltip:f(f({},R.tooltip),{},{formatter:P,hideDelay:300,enterable:!0})}),[P]);return!C&&S?u.createElement(le,null,o("common:error")):u.createElement(oe,null,u.createElement(ne,{ref:b,title:n,options:U,data:C,loading:D,zoom:!0}),u.createElement(ie,{items:[{icon:"maximize",activeIcon:"minimize",tooltip:o("pr-curve:maximize"),activeTooltip:o("pr-curve:minimize"),toggle:!0,onClick:$},{icon:"restore-size",tooltip:o("pr-curve:restore"),onClick:()=>{var e;return(e=b.current)===null||e===void 0?void 0:e.restore()}},{icon:"download",tooltip:o("pr-curve:download-image"),onClick:()=>{var e;return(e=b.current)===null||e===void 0?void 0:e.saveAsImage()}}]}))};export default ae;
