import{useCallback as s,useEffect as y,useLayoutEffect as v,useMemo as L,useRef as a,useState as f}from"../../web_modules/react.js";import{position as S,primaryColor as k,size as w}from"../utils/style.js";import{dataURL2Blob as T}from"../utils/image.js";import{saveAs as j}from"../../web_modules/file-saver.js";import A from"../../web_modules/styled-components.js";import{themes as d}from"../utils/theme.js";import b from"./useTheme.js";const z=l=>{const r=a(null),[o,u]=f(null),n=b(),m=a(l.onInit),x=a(l.onDispose),i=s(()=>o==null?void 0:o.dispatchAction({type:"hideTip"}),[o]),C=s(()=>{(async()=>{if(!r.current)return;const{default:e}=await import("../../web_modules/echarts.js");l.gl&&await import("../../web_modules/echarts-gl.js");const t=e.init(r.current);r.current.addEventListener("mouseleave",i),setTimeout(()=>{if(l.zoom&&t.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:!0}),t){var c;(c=m.current)===null||c===void 0||c.call(m,t)}},0),u(t)})()},[l.gl,l.zoom,i]),p=s(()=>{if(o){var e,t;(e=x.current)===null||e===void 0||e.call(x,o),o.dispose(),(t=r.current)===null||t===void 0||t.removeEventListener("mouseleave",i),u(null)}},[i,o]);y(()=>(C(),p),[C,p]),y(()=>{l.loading?o==null||o.showLoading("default",{text:"",color:k,textColor:d[n].textColor,maskColor:d[n].maskColor,zlevel:0}):o==null||o.hideLoading()},[l.loading,n,o]);const h=a(null);v(()=>{if(l.autoFit){const e=h.current;if(e){const t=new ResizeObserver(()=>{o==null||o.resize()});return t.observe(e),()=>t.unobserve(e)}}},[l.autoFit,o]);const g=s(e=>{if(o){const t=T(o.getDataURL({type:"png",pixelRatio:2,backgroundColor:"#FFF"}));j(t,`${(e==null?void 0:e.replace(/[/\\?%*:|"<>]/g,"_"))||"chart"}.png`)}},[o]);return{ref:r,echart:o,wrapper:h,saveAsImage:g}};export default z;export const Wrapper=A.div.withConfig({displayName:"useECharts__Wrapper",componentId:"b4c6ck-0"})(["position:relative;display:flex;justify-content:center;align-items:stretch;> .echarts{width:100%;}> .loading{"," "," display:flex;justify-content:center;align-items:center;}"],w("100%"),S("absolute",0,null,null,0)),useChartTheme=l=>{const r=b(),o=L(()=>d[r],[r]);return l?{title:{textStyle:{color:o.textColor}},tooltip:{backgroundColor:o.tooltipBackgroundColor,borderColor:o.tooltipBackgroundColor,textStyle:{color:o.tooltipTextColor}},xAxis3D:{nameTextStyle:{color:o.textLighterColor},axisLabel:{color:o.textLighterColor},axisLine:{lineStyle:{color:o.borderColor}},splitLine:{lineStyle:{color:o.borderColor}}},yAxis3D:{nameTextStyle:{color:o.textLighterColor},axisLabel:{color:o.textLighterColor},axisLine:{lineStyle:{color:o.borderColor}},splitLine:{lineStyle:{color:o.borderColor}}},zAxis3D:{nameTextStyle:{color:o.textLighterColor},axisLabel:{color:o.textLighterColor},axisLine:{lineStyle:{color:o.borderColor}},splitLine:{lineStyle:{color:o.borderColor}}}}:{title:{textStyle:{color:o.textColor}},tooltip:{backgroundColor:o.tooltipBackgroundColor,borderColor:o.tooltipBackgroundColor,textStyle:{color:o.tooltipTextColor}},xAxis:{nameTextStyle:{color:o.textLighterColor},axisLabel:{color:o.textLighterColor},axisLine:{lineStyle:{color:o.borderColor}},splitLine:{lineStyle:{color:o.borderColor}}},yAxis:{nameTextStyle:{color:o.textLighterColor},axisLabel:{color:o.textLighterColor},axisLine:{lineStyle:{color:o.borderColor}},splitLine:{lineStyle:{color:o.borderColor}}}}};
