{% extends "vendor/base.html" %}
{% load i18n %}

{% block vendor_content %}
<div class='row mx-md-5 px-md-3'>
  <div class='col-12 my-4'>
    <h1>{% trans 'SECURE CHECKOUT' %}</h1>
  </div>
  <div class='col-md-8'>
    <div class="accordion" id="checkout_accordion">
      <div class="card border-0">
        <div class="card-header mb-0 text-white p-0 border-0 mb-3" id="account_info">
          <div class='btn-group w-100'>
            <button class="btn bg-accent font-weight-bold text-dark rounded-0 border-0 px-3 py-3 m-0" type="button">
              1
            </button>
            <button class="btn btn-block font-weight-bold text-left bg-dark text-white rounded-0 border-0 py-3 m-0"
              type="button">
              Info
            </button>
          </div>
        </div>

        {% if 'account' in request.get_full_path %}
        <div id="collapseOne" class="collapse show" aria-labelledby="account_info" data-parent="#checkout_accordion">
          <div class="card-body">
            <form method="post">
              {% csrf_token %}
              <h3 class='card-title'>
                Account Info
              </h3>
              {{ form }}
              <button class="btn btn-primary btn-lg btn-block w-25" type="submit">Continue</button>
            </form>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
    <div class="card border-0">
      <div class="card-header mb-0 text-white p-0 border-0 mb-3" id="billing_info">
        <div class='btn-group w-100'>
          <button class="btn bg-accent  font-weight-bold text-dark rounded-0 border-0 px-3 py-3 m-0" type="button">
            2
          </button>
          <button class="btn btn-block font-weight-bold text-left bg-dark text-white rounded-0 border-0 py-3 m-0"
            type="button">
            Billing
          </button>
        </div>
      </div>

      {% if 'payment' in request.get_full_path %}
      <div id="collapseTwo" class="collapse show" aria-labelledby="billing_info" data-parent="#checkout_accordion">
        <div class="card-body">
          <form id="payment-form" method="post">
            {% csrf_token %}
            <h3 class='card-title'>
              Billing Address
            </h3>
            {% include "./includes/billing_address_form.html" with billing_address_form=billing_address_form %}
            <h3 class='card-title'>
              Payment Method
            </h3>
            {% include "./includes/payment_form.html" with credit_card_form=credit_card_form %}
          </form>
          <button form="payment-form" name='only-validate' class="btn btn-primary btn-lg btn-block w-25"
            type="submit">Continue</button>
        </div>
      </div>
      {% endif %}
    </div>

    <div class="card border-0">
      <div class="card-header mb-0 text-white p-0 border-0 mb-3" id="review">
        <div class='btn-group w-100'>
          <button class="btn bg-accent font-weight-bold text-dark rounded-0 border-0 px-3 py-3 m-0" type="button">
            3
          </button>
          <button class="btn btn-block font-weight-bold text-left bg-dark text-white rounded-0 border-0 py-3 m-0"
            type="button">
            Review
          </button>
        </div>
      </div>

      {% if 'review' in request.get_full_path %}
      <div id="collapseThree" class="collapse show" aria-labelledby="review" data-parent="#checkout_accordion">
        <div class="card-body">
          <h3 class='card-title'>
            Account Info
          </h3>
          <p id="review-account-name" class="mb-0">{{user.first_name}} {{user.last_name}}</p>
          <p id="review-account-email">{{user.email}}</p>
          <h3 class='card-title'>
            Billing Address
          </h3>
          <p id="review-billing-name" class="mb-0">{{request.session.credit_card_form.full_name}}</p>
          <p id="review-address-1" class="mb-0">{{request.session.billing_address_form.address_1}},
            {{request.session.billing_address_form.address_2}}</p>
          <p id="review-address-2">{{request.session.billing_address_form.state}},
            {{request.session.billing_address_form.country}},{{request.session.billing_address_form.postal_code}}
          </p>
          <h3 class='card-title'>
            Payment Method
          </h3>
          <p id="review-payment-name" class="mb-0">{{request.session.credit_card_form.full_name}}</p>
          <p id="review-payment-card">Card end in
            {{request.session.credit_card_form.card_number|slice:"-4:"}}</p>
          <form method="post">
            {% csrf_token %}
            <button class="btn btn-primary btn-lg btn-block w-25" type="submit">Place Order</button>
          </form>
        </div>
      </div>
      {% endif %}

    </div>
  </div>
  <div class="col-md-4 order-md-2 mb-4 mt-2">
    <h3 class="d-flex justify-content-between align-items-center mb-3">
      In Your Cart
    </h3>

    <ul class="list-group mb-3 border-0">
      {% for item in invoice.order_items.all %}
      <li class="px-0 d-flex justify-content-between lh-condensed">
        <div>
          <h6 class="my-0">{{ item.name }}</h6>
          <small class="text-muted">Unit Price: {{item.price}}</small>
          <small class="text-muted">Quantity: {{item.quantity}}</small>
        </div>
        <span class="text-muted">${{ item.total }}</span>
      </li>
      {% endfor %}

      <li class="px-0 border-0 d-flex justify-content-between">
        <span>Subtotal</span>
        <span>${{ invoice.subtotal }}</span>
      </li>

      <li class="px-0 justify-content-between" style="list-style-type: none;">
        <hr class="my-3 border-dark border-5" />
      </li>

      <li class="px-0 border-0 d-flex justify-content-between">
        <span class="font-weight-bolder">Total (USD)</span>
        <span class="text-primary">${{ invoice.total }}</span>
      </li>
    </ul>


    {% comment %}
    <form class="card p-2">
      <div class="input-group">
        <input type="text" class="form-control" placeholder="Promo code">
        <div class="input-group-append">
          <button type="submit" class="btn btn-secondary">Redeem</button>
        </div>
      </div>
    </form>
    {% endcomment %}
  </div>
</div>

{% endblock %}