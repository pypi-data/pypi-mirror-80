{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Wind farm"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 207,
   "metadata": {},
   "outputs": [],
   "source": [
    "import numpy as np\n",
    "from pydgrid import grid\n",
    "from pydgrid.plot_bokeh import plot_results"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "![](./png/wind_farm_gnd_statcom.png)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## System"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 210,
   "metadata": {},
   "outputs": [],
   "source": [
    "p_gen = 2000.0  # kW\n",
    "q_gen = 0       # kvar\n",
    "\n",
    "p_statcom = 0.0  # kW\n",
    "q_statcom = 0.0     # kvar\n",
    "\n",
    "data = {\n",
    "    \"lines\":[\n",
    "        {\"bus_j\": \"W1mv\",  \"bus_k\": \"W2mv\",   \"code\": \"mv_al_300\", \"m\":500},\n",
    "        {\"bus_j\": \"W2mv\",  \"bus_k\": \"W3mv\",   \"code\": \"mv_al_300\", \"m\":500},    \n",
    "        {\"bus_j\": \"W3mv\",  \"bus_k\": \"POImv\",  \"code\": \"mv_al_300\", \"m\":500},      \n",
    "        {\"bus_j\": \"POI\",  \"bus_k\": \"GRID\",  \"code\": \"hv_line\", \"m\":50.0e3},\n",
    "            ],\n",
    "    \"buses\":[\n",
    "            {\"bus\": \"W1lv\",  \"pos_x\": -1500.0, \"pos_y\":  200.0, \"units\": \"m\", \"U_kV\":0.69},\n",
    "            {\"bus\": \"W2lv\",  \"pos_x\": -1000.0, \"pos_y\":  200.0, \"units\": \"m\", \"U_kV\":0.69},\n",
    "            {\"bus\": \"W3lv\",  \"pos_x\":  -500.0, \"pos_y\":  200.0, \"units\": \"m\", \"U_kV\":0.69},\n",
    "            {\"bus\": \"W1mv\",  \"pos_x\": -1500.0, \"pos_y\":  180.0, \"units\": \"m\", \"U_kV\":20.0},\n",
    "            {\"bus\": \"W2mv\",  \"pos_x\": -1000.0, \"pos_y\":  180.0, \"units\": \"m\", \"U_kV\":20.0},\n",
    "            {\"bus\": \"W3mv\",  \"pos_x\":  -500.0, \"pos_y\":  180.0, \"units\": \"m\", \"U_kV\":20.0},        \n",
    "            {\"bus\": \"POImv\", \"pos_x\":     0.0, \"pos_y\":    0.0, \"units\": \"m\", \"U_kV\":20.0},\n",
    "            {\"bus\": \"POI\",   \"pos_x\":   100.0, \"pos_y\":    0.0, \"units\": \"m\", \"U_kV\":66.0},\n",
    "            {\"bus\": \"GRID\",  \"pos_x\":   500.0, \"pos_y\":    0.0, \"units\": \"m\", \"U_kV\":66.0},\n",
    "    \t\t],\n",
    "    \"transformers\":[\n",
    "                    {\"bus_j\": \"POImv\",  \"bus_k\": \"POI\",  \"S_n_kVA\": 10000.0, \"U_1_kV\":20.0, \"U_2_kV\":66.0,\n",
    "                    \"R_cc_pu\": 0.01, \"X_cc_pu\":0.08, \"connection\": \"Dyg11_3w\",   \"conductors_1\": 3, \"conductors_2\": 3},\n",
    "                    {\"bus_j\": \"W1mv\",  \"bus_k\": \"W1lv\",  \"S_n_kVA\": 2500.0, \"U_1_kV\":20, \"U_2_kV\":0.69,\n",
    "                    \"R_cc_pu\": 0.01, \"X_cc_pu\":0.06, \"connection\": \"Dyg11_3w\",   \"conductors_1\": 3, \"conductors_2\": 3},\n",
    "                    {\"bus_j\": \"W2mv\",  \"bus_k\": \"W2lv\",  \"S_n_kVA\": 2500.0, \"U_1_kV\":20, \"U_2_kV\":0.69,\n",
    "                    \"R_cc_pu\": 0.01, \"X_cc_pu\":0.06, \"connection\": \"Dyg11_3w\",   \"conductors_1\": 3, \"conductors_2\": 3},\n",
    "                    {\"bus_j\": \"W3mv\",  \"bus_k\": \"W3lv\",  \"S_n_kVA\": 2500.0, \"U_1_kV\":20, \"U_2_kV\":0.69,\n",
    "                    \"R_cc_pu\": 0.01, \"X_cc_pu\":0.06, \"connection\": \"Dyg11_3w\",   \"conductors_1\": 3, \"conductors_2\": 3},\n",
    "                    ],\n",
    "    \"grid_formers\":[\n",
    "    \t\t{\"bus\": \"GRID\",\"bus_nodes\": [1, 2, 3],\n",
    "    \t\t\t\"kV\": [38.105, 38.105, 38.105], \"deg\": [30, 150, 270.0]\n",
    "    \t\t}\n",
    "    \t\t],\n",
    "    \"grid_feeders\":[{\"bus\": \"W1lv\",\"bus_nodes\": [1, 2, 3],\"kW\": p_gen, \"kvar\": q_gen},\n",
    "                    {\"bus\": \"W2lv\",\"bus_nodes\": [1, 2, 3],\"kW\": p_gen, \"kvar\": q_gen},\n",
    "                    {\"bus\": \"W3lv\",\"bus_nodes\": [1, 2, 3],\"kW\": p_gen, \"kvar\": q_gen},\n",
    "                    {\"bus\": \"POImv\",\"bus_nodes\": [1, 2, 3],\"kW\": p_statcom, \"kvar\": q_statcom} # STATCOM\n",
    "    ],\n",
    "    \"groundings\":[\n",
    "        {\"bus\": \"POImv\" , \"R_gnd\":32.0, \"X_gnd\":0.0, \"conductors\": 3}\n",
    "       ],\n",
    "    \"line_codes\":\n",
    "        {\n",
    "        \"mv_al_150\":   {\"R1\":0.262,  \"X1\":0.118, \"C_1_muF\":0.250 },\n",
    "        \"mv_al_185\":   {\"R1\":0.209,  \"X1\":0.113, \"C_1_muF\":0.281 },\n",
    "        \"mv_al_240\":   {\"R1\":0.161,  \"X1\":0.109, \"C_1_muF\":0.301 },  \n",
    "        \"mv_al_300\":   {\"R1\":0.128,  \"X1\":0.105, \"C_1_muF\":0.340 }, \n",
    "         \"hv_line\":  {\"R1\":0.219, \"X1\":0.365, \"R0\":0.219,   \"X0\":0.365}            \n",
    "        }\n",
    "    }"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 211,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "\n",
       "\n",
       "\n",
       "\n",
       "\n",
       "\n",
       "  <div class=\"bk-root\" id=\"98a40e77-5be2-4d1c-8d62-7a4ec4999cb5\"></div>\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/javascript": [
       "(function(root) {\n",
       "  function embed_document(root) {\n",
       "    \n",
       "  var docs_json = {\"acecc11d-bdb9-4d7f-9f5a-cb44f153d9df\":{\"roots\":{\"references\":[{\"attributes\":{\"below\":[{\"id\":\"1481\",\"type\":\"LinearAxis\"}],\"left\":[{\"id\":\"1486\",\"type\":\"LinearAxis\"}],\"plot_height\":400,\"renderers\":[{\"id\":\"1481\",\"type\":\"LinearAxis\"},{\"id\":\"1485\",\"type\":\"Grid\"},{\"id\":\"1486\",\"type\":\"LinearAxis\"},{\"id\":\"1490\",\"type\":\"Grid\"},{\"id\":\"1499\",\"type\":\"BoxAnnotation\"},{\"id\":\"1510\",\"type\":\"GlyphRenderer\"},{\"id\":\"1516\",\"type\":\"GlyphRenderer\"},{\"id\":\"1522\",\"type\":\"GlyphRenderer\"}],\"title\":{\"id\":\"1470\",\"type\":\"Title\"},\"toolbar\":{\"id\":\"1497\",\"type\":\"Toolbar\"},\"x_range\":{\"id\":\"1473\",\"type\":\"DataRange1d\"},\"x_scale\":{\"id\":\"1477\",\"type\":\"LinearScale\"},\"y_range\":{\"id\":\"1475\",\"type\":\"DataRange1d\"},\"y_scale\":{\"id\":\"1479\",\"type\":\"LinearScale\"}},\"id\":\"1471\",\"subtype\":\"Figure\",\"type\":\"Plot\"},{\"attributes\":{\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1515\",\"type\":\"MultiLine\"},{\"attributes\":{},\"id\":\"1487\",\"type\":\"BasicTicker\"},{\"attributes\":{},\"id\":\"1575\",\"type\":\"Selection\"},{\"attributes\":{\"data_source\":{\"id\":\"1512\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"1514\",\"type\":\"MultiLine\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"1515\",\"type\":\"MultiLine\"},\"selection_glyph\":null,\"view\":{\"id\":\"1517\",\"type\":\"CDSView\"}},\"id\":\"1516\",\"type\":\"GlyphRenderer\"},{\"attributes\":{\"dimension\":1,\"plot\":{\"id\":\"1471\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1487\",\"type\":\"BasicTicker\"}},\"id\":\"1490\",\"type\":\"Grid\"},{\"attributes\":{},\"id\":\"1576\",\"type\":\"UnionRenderers\"},{\"attributes\":{\"source\":{\"id\":\"1512\",\"type\":\"ColumnDataSource\"}},\"id\":\"1517\",\"type\":\"CDSView\"},{\"attributes\":{},\"id\":\"1577\",\"type\":\"Selection\"},{\"attributes\":{\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"green\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1508\",\"type\":\"MultiLine\"},{\"attributes\":{\"callback\":null,\"data\":{\"bus_id\":[\"W1lv\",\"W2lv\",\"W3lv\",\"W1mv\",\"W2mv\",\"W3mv\",\"POImv\",\"POI\",\"GRID\"],\"deg_an\":[\"36.87\",\"36.85\",\"36.83\",\"4.23\",\"4.21\",\"4.18\",\"4.14\",\"31.47\",\"30.00\"],\"deg_bn\":[\"156.87\",\"156.85\",\"156.83\",\"124.23\",\"124.21\",\"124.18\",\"124.14\",\"151.47\",\"150.00\"],\"deg_cn\":[\"-83.13\",\"-83.15\",\"-83.17\",\"-115.77\",\"-115.79\",\"-115.82\",\"-115.86\",\"-88.53\",\"-90.00\"],\"deg_ng\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\"],\"p_a\":[\"666.67\",\"666.67\",\"666.67\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"-1941.53\"],\"p_abc\":[\"2000.00\",\"2000.00\",\"2000.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"-5824.60\"],\"p_b\":[\"666.67\",\"666.67\",\"666.67\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"-1941.53\"],\"p_c\":[\"666.67\",\"666.67\",\"666.67\",\"-0.00\",\"-0.00\",\"-0.00\",\"-0.00\",\"0.00\",\"-1941.53\"],\"q_a\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"211.38\"],\"q_abc\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"634.15\"],\"q_b\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"211.38\"],\"q_c\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"-0.00\",\"211.38\"],\"s_color\":[\"red\",\"red\",\"red\",\"blue\",\"blue\",\"red\",\"blue\",\"blue\",\"green\"],\"s_radio\":[14.142136308156395,14.142136302059251,14.142136289873903,1,1,1,1,1,20],\"u_avg_pu\":[\"1.024\",\"1.024\",\"1.023\",\"1.017\",\"1.017\",\"1.016\",\"1.015\",\"1.012\",\"1.000\"],\"v_ab\":[706.507628879133,706.3003322837995,705.8848021048145,20343.836033194602,20337.800697387556,20325.7027327372,20307.54458218266,66812.8354800361,65999.79602241208],\"v_an\":[\"407.90\",\"407.78\",\"407.54\",\"11745.52\",\"11742.03\",\"11735.05\",\"11724.57\",\"38574.41\",\"38105.00\"],\"v_an_pu\":[\"1.0239\",\"1.0236\",\"1.0230\",\"1.0172\",\"1.0169\",\"1.0163\",\"1.0154\",\"1.0123\",\"1.0000\"],\"v_bc\":[706.507628471797,706.3003318777999,705.8848017014928,20343.836028670685,20337.800692902227,20325.702728328924,20307.5445778896,66812.83547143811,65999.79602241208],\"v_bn\":[\"407.90\",\"407.78\",\"407.54\",\"11745.52\",\"11742.03\",\"11735.05\",\"11724.57\",\"38574.41\",\"38105.00\"],\"v_bn_pu\":[\"1.0239\",\"1.0236\",\"1.0230\",\"1.0172\",\"1.0169\",\"1.0163\",\"1.0154\",\"1.0123\",\"1.0000\"],\"v_ca\":[706.507628627443,706.3003320340528,705.8848018589537,20343.83603595091,20337.800700153566,20325.70273552244,20307.544584996296,66812.8354731626,65999.79602241208],\"v_cn\":[\"407.90\",\"407.78\",\"407.54\",\"11745.52\",\"11742.03\",\"11735.05\",\"11724.57\",\"38574.41\",\"38105.00\"],\"v_cn_pu\":[\"1.0239\",\"1.0236\",\"1.0230\",\"1.0172\",\"1.0169\",\"1.0163\",\"1.0154\",\"1.0123\",\"1.0000\"],\"v_ng\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\"],\"v_unb\":[\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\"],\"x\":[-1500.0,-1000.0,-500.0,-1500.0,-1000.0,-500.0,0.0,100.0,500.0],\"y\":[200.0,200.0,200.0,180.0,180.0,180.0,0.0,0.0,0.0]},\"selected\":{\"id\":\"1577\",\"type\":\"Selection\"},\"selection_policy\":{\"id\":\"1576\",\"type\":\"UnionRenderers\"}},\"id\":\"1518\",\"type\":\"ColumnDataSource\"},{\"attributes\":{\"active_drag\":\"auto\",\"active_inspect\":\"auto\",\"active_multi\":null,\"active_scroll\":\"auto\",\"active_tap\":\"auto\",\"tools\":[{\"id\":\"1491\",\"type\":\"PanTool\"},{\"id\":\"1492\",\"type\":\"WheelZoomTool\"},{\"id\":\"1493\",\"type\":\"BoxZoomTool\"},{\"id\":\"1494\",\"type\":\"SaveTool\"},{\"id\":\"1495\",\"type\":\"ResetTool\"},{\"id\":\"1496\",\"type\":\"HelpTool\"},{\"id\":\"1524\",\"type\":\"HoverTool\"},{\"id\":\"1526\",\"type\":\"HoverTool\"},{\"id\":\"1528\",\"type\":\"HoverTool\"}]},\"id\":\"1497\",\"type\":\"Toolbar\"},{\"attributes\":{},\"id\":\"1491\",\"type\":\"PanTool\"},{\"attributes\":{\"fill_alpha\":{\"value\":0.5},\"fill_color\":{\"value\":\"navy\"},\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"navy\"},\"size\":{\"units\":\"screen\",\"value\":15},\"x\":{\"field\":\"x\"},\"y\":{\"field\":\"y\"}},\"id\":\"1520\",\"type\":\"Circle\"},{\"attributes\":{},\"id\":\"1492\",\"type\":\"WheelZoomTool\"},{\"attributes\":{\"fill_alpha\":{\"value\":0.1},\"fill_color\":{\"value\":\"#1f77b4\"},\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"size\":{\"units\":\"screen\",\"value\":15},\"x\":{\"field\":\"x\"},\"y\":{\"field\":\"y\"}},\"id\":\"1521\",\"type\":\"Circle\"},{\"attributes\":{\"overlay\":{\"id\":\"1499\",\"type\":\"BoxAnnotation\"}},\"id\":\"1493\",\"type\":\"BoxZoomTool\"},{\"attributes\":{\"data_source\":{\"id\":\"1518\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"1520\",\"type\":\"Circle\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"1521\",\"type\":\"Circle\"},\"selection_glyph\":null,\"view\":{\"id\":\"1523\",\"type\":\"CDSView\"}},\"id\":\"1522\",\"type\":\"GlyphRenderer\"},{\"attributes\":{},\"id\":\"1494\",\"type\":\"SaveTool\"},{\"attributes\":{\"source\":{\"id\":\"1518\",\"type\":\"ColumnDataSource\"}},\"id\":\"1523\",\"type\":\"CDSView\"},{\"attributes\":{},\"id\":\"1495\",\"type\":\"ResetTool\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"1510\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            transformer id = @trafo_id  \\n            <table border=\\\"5\\\">\\n                <tr >\\n                    <td>I<sub>1a</sub> =  @i_1a_m &ang; @deg_1a </td>\\n                    <td>I<sub>2a</sub> =  @i_2a_m &ang; @deg_2a </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>1b</sub> =  @i_1b_m &ang; @deg_1b </td>\\n                    <td >I<sub>2b</sub> =  @i_2b_m &ang; @deg_2b </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>1c</sub> =  @i_1c_m &ang; @deg_1c </td>\\n                    <td >I<sub>2c</sub> =  @i_2c_m &ang; @deg_2c </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>1n</sub> =  @i_1n_m &ang; @deg_1n </td>\\n                    <td >I<sub>2n</sub> =  @i_2n_m &ang; @deg_2n </td>\\n                </tr>\\n            </table>            \\n            </div>\\n            \"},\"id\":\"1524\",\"type\":\"HoverTool\"},{\"attributes\":{},\"id\":\"1496\",\"type\":\"HelpTool\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"1516\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            line id = @line_id \\n            <table border=\\\"5\\\">\\n                <tr >\\n                    <td>I<sub>ja</sub> =  @i_j_a_m &ang; @deg_j_a </td>\\n                    <td>I<sub>ka</sub> =  @i_k_a_m &ang; @deg_k_a </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>jb</sub> =  @i_j_b_m &ang; @deg_j_b </td>\\n                    <td >I<sub>kb</sub> =  @i_k_b_m &ang; @deg_k_b </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>jc</sub> =  @i_j_c_m &ang; @deg_j_c </td>\\n                    <td >I<sub>kc</sub> =  @i_k_c_m &ang; @deg_k_c </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>jn</sub> =  @i_j_n_m &ang; @deg_j_n </td>\\n                    <td >I<sub>kn</sub> =  @i_k_n_m &ang; @deg_k_n </td>\\n                </tr>\\n            </table>            \\n            </div>\\n            \"},\"id\":\"1526\",\"type\":\"HoverTool\"},{\"attributes\":{},\"id\":\"1477\",\"type\":\"LinearScale\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"1522\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            bus_id = @bus_id &nbsp &nbsp |  u<sub>avg</sub>= @u_avg_pu pu |  u<sub>unb</sub>= @v_unb %\\n            <table border=\\\"1\\\">\\n                <tr>\\n                <td>v<sub>an</sub> =  @v_an  &ang; @deg_an V </td> <td> S<sub>a</sub> = @p_a + j@q_a kVA</td>\\n                </tr>\\n                      <tr>\\n                      <td> </td> <td>v<sub>ab</sub>= @v_ab V</td>\\n                      </tr>\\n                <tr>\\n                <td>v<sub>bn</sub> = @v_bn &ang; @deg_bn V </td><td> S<sub>b</sub> = @p_b + j@q_b kVA</td>\\n                </tr>\\n                      <tr>\\n                      <td> </td><td>v<sub>bc</sub>= @v_bc V</td>\\n                      </tr>\\n                <tr>\\n                <td>v<sub>cn</sub>  = @v_cn &ang; @deg_cn V </td>  <td>S<sub>c</sub> = @p_c + j@q_c kVA </td>\\n                </tr> \\n                    <tr>\\n                     <td> </td> <td>v<sub>ca</sub>= @v_ca V</td>\\n                    </tr>\\n               <tr>\\n                <td>v<sub>ng</sub>    = @v_ng &ang; @deg_ng V</td>  <td>S<sub>abc</sub> = @p_abc + j@q_abc kVA </td>\\n              </tr>\\n            </table>\\n            </div>\\n            \"},\"id\":\"1528\",\"type\":\"HoverTool\"},{\"attributes\":{\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1509\",\"type\":\"MultiLine\"},{\"attributes\":{\"bottom_units\":\"screen\",\"fill_alpha\":{\"value\":0.5},\"fill_color\":{\"value\":\"lightgrey\"},\"left_units\":\"screen\",\"level\":\"overlay\",\"line_alpha\":{\"value\":1.0},\"line_color\":{\"value\":\"black\"},\"line_dash\":[4,4],\"line_width\":{\"value\":2},\"plot\":null,\"render_mode\":\"css\",\"right_units\":\"screen\",\"top_units\":\"screen\"},\"id\":\"1499\",\"type\":\"BoxAnnotation\"},{\"attributes\":{\"callback\":null,\"data\":{\"deg_1a\":[6.213591476413193,-173.132124091996,-173.14570653339382,-173.1727897030232],\"deg_1b\":[126.21359175015131,-53.13212381709,-53.14570625936522,-53.17278943075554],\"deg_1c\":[-113.78640841645081,66.8678760191311,66.85429357669302,66.82721040497881],\"deg_1n\":[-90.0,153.434948822922,33.690067525979785,33.690067525979785],\"deg_2a\":[-143.78640854340895,36.867876683705084,36.85429424240506,36.827211072949936],\"deg_2b\":[-23.78640837680635,156.86787651078055,156.85429406383759,156.82721088311558],\"deg_2c\":[96.21359173032938,-83.1321250844406,-83.14570752230858,-83.17279068486519],\"deg_2n\":[108.43494882292202,178.02684352986077,177.82913882383585,177.430467881346],\"i_1a_m\":[169.13591847526712,56.38604719860061,56.402596251080496,56.43579842827606],\"i_1b_m\":[169.13591837391735,56.386047168684584,56.402596220472184,56.435798396279914],\"i_1c_m\":[169.1359177247841,56.386046949347154,56.4025960021603,56.435798180026566],\"i_1n_m\":[2.2737367544323206e-13,1.2710574864626038e-13,2.0495186137532011e-13,2.0495186137532011e-13],\"i_2a_m\":[51.253308487493435,1634.3781470401523,1634.8578298922462,1635.8202121836582],\"i_2b_m\":[51.253308684200405,1634.3782151469215,1634.857897749773,1635.820279541211],\"i_2c_m\":[51.2533084567815,1634.3781687298092,1634.8578513061782,1635.8202330456431],\"i_2n_m\":[5.392640207733813e-13,0.00010823871404747233,0.00010790842994351482,0.00010724896131731893],\"trafo_id\":[\"POImv-POI\",\"W1mv-W1lv\",\"W2mv-W2lv\",\"W3mv-W3lv\"],\"x_s\":[[0.0,100.0],[-1500.0,-1500.0],[-1000.0,-1000.0],[-500.0,-500.0]],\"y_s\":[[0.0,0.0],[180.0,200.0],[180.0,200.0],[180.0,200.0]]},\"selected\":{\"id\":\"1573\",\"type\":\"Selection\"},\"selection_policy\":{\"id\":\"1572\",\"type\":\"UnionRenderers\"}},\"id\":\"1506\",\"type\":\"ColumnDataSource\"},{\"attributes\":{\"plot\":null,\"text\":\"Results\"},\"id\":\"1470\",\"type\":\"Title\"},{\"attributes\":{},\"id\":\"1479\",\"type\":\"LinearScale\"},{\"attributes\":{},\"id\":\"1568\",\"type\":\"BasicTickFormatter\"},{\"attributes\":{\"data_source\":{\"id\":\"1506\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"1508\",\"type\":\"MultiLine\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"1509\",\"type\":\"MultiLine\"},\"selection_glyph\":null,\"view\":{\"id\":\"1511\",\"type\":\"CDSView\"}},\"id\":\"1510\",\"type\":\"GlyphRenderer\"},{\"attributes\":{\"callback\":null},\"id\":\"1473\",\"type\":\"DataRange1d\"},{\"attributes\":{\"formatter\":{\"id\":\"1568\",\"type\":\"BasicTickFormatter\"},\"plot\":{\"id\":\"1471\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1482\",\"type\":\"BasicTicker\"}},\"id\":\"1481\",\"type\":\"LinearAxis\"},{\"attributes\":{},\"id\":\"1570\",\"type\":\"BasicTickFormatter\"},{\"attributes\":{\"source\":{\"id\":\"1506\",\"type\":\"ColumnDataSource\"}},\"id\":\"1511\",\"type\":\"CDSView\"},{\"attributes\":{\"callback\":null},\"id\":\"1475\",\"type\":\"DataRange1d\"},{\"attributes\":{},\"id\":\"1482\",\"type\":\"BasicTicker\"},{\"attributes\":{},\"id\":\"1572\",\"type\":\"UnionRenderers\"},{\"attributes\":{\"callback\":null,\"data\":{\"deg_j_a\":[6.867875908067212,6.542730826309239,6.425482354549469,36.21359145659167],\"deg_j_b\":[126.86787618295459,126.54273110075957,126.42548262827486,156.21359162319388],\"deg_j_c\":[-113.13212398080066,-113.45726906440234,-113.57451753744715,-83.78640826967003],\"deg_j_n\":[135.35999774383666,100.1182951844973,83.12967577323916,71.65279349671623],\"deg_k_a\":[6.230935705962935,6.224380772208255,6.21344747888888,36.21359145659167],\"deg_k_b\":[126.23093598084644,126.224381046646,126.21344775260158,156.21359162319388],\"deg_k_c\":[-113.76906418553042,-113.77561911981954,-113.78655241398488,-83.78640826967003],\"deg_k_n\":[134.66097567554854,99.91026965955483,82.66807833497847,71.65279349671623],\"i_j_a_m\":[56.386047198525574,112.76146970519216,169.17125822006966,51.253308487493456],\"i_j_b_m\":[56.38604716863718,112.76146964174555,169.17125812168754,51.253308684200555],\"i_j_c_m\":[56.386046949297985,112.76146920564639,169.17125747092848,51.253308456781035],\"i_j_n_m\":[1.0395473345625449e-11,6.285158373849342e-11,2.9342951209863505e-11,3.6681231091406495e-13],\"i_k_a_m\":[56.36054187457063,112.7375414227619,169.14763533287055,51.253308487493456],\"i_k_b_m\":[56.36054184171556,112.73754135635264,169.14763523153354,51.253308684200555],\"i_k_c_m\":[56.36054162396904,112.73754092185567,169.1476345823821,51.253308456781035],\"i_k_n_m\":[1.0189450395680969e-11,6.275359618143382e-11,2.928644779221924e-11,3.6681231091406495e-13],\"line_id\":[\"W1mv-W2mv\",\"W2mv-W3mv\",\"W3mv-POImv\",\"POI-GRID\"],\"x_s\":[[-1500.0,-1000.0],[-1000.0,-500.0],[-500.0,0.0],[100.0,500.0]],\"y_s\":[[180.0,180.0],[180.0,180.0],[180.0,0.0],[0.0,0.0]]},\"selected\":{\"id\":\"1575\",\"type\":\"Selection\"},\"selection_policy\":{\"id\":\"1574\",\"type\":\"UnionRenderers\"}},\"id\":\"1512\",\"type\":\"ColumnDataSource\"},{\"attributes\":{\"plot\":{\"id\":\"1471\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1482\",\"type\":\"BasicTicker\"}},\"id\":\"1485\",\"type\":\"Grid\"},{\"attributes\":{},\"id\":\"1573\",\"type\":\"Selection\"},{\"attributes\":{\"formatter\":{\"id\":\"1570\",\"type\":\"BasicTickFormatter\"},\"plot\":{\"id\":\"1471\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1487\",\"type\":\"BasicTicker\"}},\"id\":\"1486\",\"type\":\"LinearAxis\"},{\"attributes\":{\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"red\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1514\",\"type\":\"MultiLine\"},{\"attributes\":{},\"id\":\"1574\",\"type\":\"UnionRenderers\"}],\"root_ids\":[\"1471\"]},\"title\":\"Bokeh Application\",\"version\":\"1.0.1\"}};\n",
       "  var render_items = [{\"docid\":\"acecc11d-bdb9-4d7f-9f5a-cb44f153d9df\",\"roots\":{\"1471\":\"98a40e77-5be2-4d1c-8d62-7a4ec4999cb5\"}}];\n",
       "  root.Bokeh.embed.embed_items_notebook(docs_json, render_items);\n",
       "\n",
       "  }\n",
       "  if (root.Bokeh !== undefined) {\n",
       "    embed_document(root);\n",
       "  } else {\n",
       "    var attempts = 0;\n",
       "    var timer = setInterval(function(root) {\n",
       "      if (root.Bokeh !== undefined) {\n",
       "        embed_document(root);\n",
       "        clearInterval(timer);\n",
       "      }\n",
       "      attempts++;\n",
       "      if (attempts > 100) {\n",
       "        console.log(\"Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing\");\n",
       "        clearInterval(timer);\n",
       "      }\n",
       "    }, 10, root)\n",
       "  }\n",
       "})(window);"
      ],
      "application/vnd.bokehjs_exec.v0+json": ""
     },
     "metadata": {
      "application/vnd.bokehjs_exec.v0+json": {
       "id": "1471"
      }
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "grid_1 = grid()\n",
    "grid_1.read(data)  # Load data\n",
    "grid_1.pf()  # solve power flow\n",
    "p=plot_results(grid_1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 214,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "5910895.785662318"
      ]
     },
     "execution_count": 214,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "mon = grid_1.monitor(bus_from='POI',bus_to='GRID')\n",
    "mon.P\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 215,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "-490329.45241958584"
      ]
     },
     "execution_count": 215,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "mon.Q\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Short circuits"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Three phase at MV side POI"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "\n",
       "\n",
       "\n",
       "\n",
       "\n",
       "\n",
       "  <div class=\"bk-root\" id=\"bdb87cbf-cef3-4aaa-b133-51ae5cdcf883\"></div>\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/javascript": [
       "(function(root) {\n",
       "  function embed_document(root) {\n",
       "    \n",
       "  var docs_json = {\"1dcf70e0-48f3-47d0-bed1-e028de2f1e33\":{\"roots\":{\"references\":[{\"attributes\":{\"below\":[{\"id\":\"1157\",\"type\":\"LinearAxis\"}],\"left\":[{\"id\":\"1162\",\"type\":\"LinearAxis\"}],\"plot_height\":400,\"renderers\":[{\"id\":\"1157\",\"type\":\"LinearAxis\"},{\"id\":\"1161\",\"type\":\"Grid\"},{\"id\":\"1162\",\"type\":\"LinearAxis\"},{\"id\":\"1166\",\"type\":\"Grid\"},{\"id\":\"1175\",\"type\":\"BoxAnnotation\"},{\"id\":\"1186\",\"type\":\"GlyphRenderer\"},{\"id\":\"1192\",\"type\":\"GlyphRenderer\"},{\"id\":\"1198\",\"type\":\"GlyphRenderer\"}],\"title\":{\"id\":\"1146\",\"type\":\"Title\"},\"toolbar\":{\"id\":\"1173\",\"type\":\"Toolbar\"},\"x_range\":{\"id\":\"1149\",\"type\":\"DataRange1d\"},\"x_scale\":{\"id\":\"1153\",\"type\":\"LinearScale\"},\"y_range\":{\"id\":\"1151\",\"type\":\"DataRange1d\"},\"y_scale\":{\"id\":\"1155\",\"type\":\"LinearScale\"}},\"id\":\"1147\",\"subtype\":\"Figure\",\"type\":\"Plot\"},{\"attributes\":{\"fill_alpha\":{\"value\":0.1},\"fill_color\":{\"value\":\"#1f77b4\"},\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"size\":{\"units\":\"screen\",\"value\":15},\"x\":{\"field\":\"x\"},\"y\":{\"field\":\"y\"}},\"id\":\"1197\",\"type\":\"Circle\"},{\"attributes\":{},\"id\":\"1167\",\"type\":\"PanTool\"},{\"attributes\":{\"source\":{\"id\":\"1188\",\"type\":\"ColumnDataSource\"}},\"id\":\"1193\",\"type\":\"CDSView\"},{\"attributes\":{\"active_drag\":\"auto\",\"active_inspect\":\"auto\",\"active_multi\":null,\"active_scroll\":\"auto\",\"active_tap\":\"auto\",\"tools\":[{\"id\":\"1167\",\"type\":\"PanTool\"},{\"id\":\"1168\",\"type\":\"WheelZoomTool\"},{\"id\":\"1169\",\"type\":\"BoxZoomTool\"},{\"id\":\"1170\",\"type\":\"SaveTool\"},{\"id\":\"1171\",\"type\":\"ResetTool\"},{\"id\":\"1172\",\"type\":\"HelpTool\"},{\"id\":\"1200\",\"type\":\"HoverTool\"},{\"id\":\"1202\",\"type\":\"HoverTool\"},{\"id\":\"1204\",\"type\":\"HoverTool\"}]},\"id\":\"1173\",\"type\":\"Toolbar\"},{\"attributes\":{},\"id\":\"1224\",\"type\":\"UnionRenderers\"},{\"attributes\":{\"data_source\":{\"id\":\"1188\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"1190\",\"type\":\"MultiLine\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"1191\",\"type\":\"MultiLine\"},\"selection_glyph\":null,\"view\":{\"id\":\"1193\",\"type\":\"CDSView\"}},\"id\":\"1192\",\"type\":\"GlyphRenderer\"},{\"attributes\":{\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1191\",\"type\":\"MultiLine\"},{\"attributes\":{},\"id\":\"1153\",\"type\":\"LinearScale\"},{\"attributes\":{\"dimension\":1,\"plot\":{\"id\":\"1147\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1163\",\"type\":\"BasicTicker\"}},\"id\":\"1166\",\"type\":\"Grid\"},{\"attributes\":{},\"id\":\"1158\",\"type\":\"BasicTicker\"},{\"attributes\":{\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"red\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1190\",\"type\":\"MultiLine\"},{\"attributes\":{\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1185\",\"type\":\"MultiLine\"},{\"attributes\":{\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"green\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1184\",\"type\":\"MultiLine\"},{\"attributes\":{},\"id\":\"1223\",\"type\":\"Selection\"},{\"attributes\":{},\"id\":\"1171\",\"type\":\"ResetTool\"},{\"attributes\":{\"callback\":null,\"data\":{\"deg_j_a\":[131.17227140470305,-128.4442682192804,-128.43598383610097,136.08012625295936],\"deg_j_b\":[-174.20457191277166,-116.15757221544901,-116.14991058883352,-103.91987381031588],\"deg_j_c\":[-28.533946334329773,-123.01162401573987,-123.02318907308799,16.080126207740427],\"deg_j_n\":[159.34566820533743,-123.03906965405233,-123.03563902856486,9.462322208025617],\"deg_k_a\":[-128.44426822098208,-128.43598383527265,-128.43236254337242,136.08012625295936],\"deg_k_b\":[-116.1575722140015,-116.149910589647,-116.14612070913581,-103.91987381031588],\"deg_k_c\":[-123.01162401552443,-123.02318907265744,-123.02534661102234,16.080126207740427],\"deg_k_n\":[-123.03906965413701,-123.03563902843074,-123.0333203647407,9.462322208025617],\"i_j_a_m\":[1.1466907233927718e-12,4.229552644832038e-09,8.459220097025335e-09,689.5580396030568],\"i_j_b_m\":[9.188880976065832e-13,3.3166720688695897e-09,6.632787522813428e-09,689.558039414319],\"i_j_c_m\":[9.636999384236057e-13,2.1438446498015033e-09,4.287686521442447e-09,689.5580401681848],\"i_j_n_m\":[8.789367390300862e-13,9.647369060961627e-09,1.9294306196471356e-08,3.457650183405701e-13],\"i_k_a_m\":[4.229552644710725e-09,8.459220097092706e-09,1.2688703725951639e-08,689.5580396030568],\"i_k_b_m\":[3.3166720689372853e-09,6.632787522738427e-09,9.948762292051998e-09,689.558039414319],\"i_k_c_m\":[2.1438446498282944e-09,4.287686521476057e-09,6.431372194100972e-09,689.5580401681848],\"i_k_n_m\":[9.647369060912977e-09,1.9294306196520374e-08,2.8940756484233945e-08,3.457650183405701e-13],\"line_id\":[\"W1mv-W2mv\",\"W2mv-W3mv\",\"W3mv-POImv\",\"POI-GRID\"],\"x_s\":[[-1500.0,-1000.0],[-1000.0,-500.0],[-500.0,0.0],[100.0,500.0]],\"y_s\":[[180.0,180.0],[180.0,180.0],[180.0,0.0],[0.0,0.0]]},\"selected\":{\"id\":\"1225\",\"type\":\"Selection\"},\"selection_policy\":{\"id\":\"1226\",\"type\":\"UnionRenderers\"}},\"id\":\"1188\",\"type\":\"ColumnDataSource\"},{\"attributes\":{},\"id\":\"1163\",\"type\":\"BasicTicker\"},{\"attributes\":{\"source\":{\"id\":\"1182\",\"type\":\"ColumnDataSource\"}},\"id\":\"1187\",\"type\":\"CDSView\"},{\"attributes\":{\"formatter\":{\"id\":\"1220\",\"type\":\"BasicTickFormatter\"},\"plot\":{\"id\":\"1147\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1158\",\"type\":\"BasicTicker\"}},\"id\":\"1157\",\"type\":\"LinearAxis\"},{\"attributes\":{\"data_source\":{\"id\":\"1182\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"1184\",\"type\":\"MultiLine\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"1185\",\"type\":\"MultiLine\"},\"selection_glyph\":null,\"view\":{\"id\":\"1187\",\"type\":\"CDSView\"}},\"id\":\"1186\",\"type\":\"GlyphRenderer\"},{\"attributes\":{},\"id\":\"1220\",\"type\":\"BasicTickFormatter\"},{\"attributes\":{\"bottom_units\":\"screen\",\"fill_alpha\":{\"value\":0.5},\"fill_color\":{\"value\":\"lightgrey\"},\"left_units\":\"screen\",\"level\":\"overlay\",\"line_alpha\":{\"value\":1.0},\"line_color\":{\"value\":\"black\"},\"line_dash\":[4,4],\"line_width\":{\"value\":2},\"plot\":null,\"render_mode\":\"css\",\"right_units\":\"screen\",\"top_units\":\"screen\"},\"id\":\"1175\",\"type\":\"BoxAnnotation\"},{\"attributes\":{},\"id\":\"1228\",\"type\":\"UnionRenderers\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"1192\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            line id = @line_id \\n            <table border=\\\"5\\\">\\n                <tr >\\n                    <td>I<sub>ja</sub> =  @i_j_a_m &ang; @deg_j_a </td>\\n                    <td>I<sub>ka</sub> =  @i_k_a_m &ang; @deg_k_a </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>jb</sub> =  @i_j_b_m &ang; @deg_j_b </td>\\n                    <td >I<sub>kb</sub> =  @i_k_b_m &ang; @deg_k_b </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>jc</sub> =  @i_j_c_m &ang; @deg_j_c </td>\\n                    <td >I<sub>kc</sub> =  @i_k_c_m &ang; @deg_k_c </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>jn</sub> =  @i_j_n_m &ang; @deg_j_n </td>\\n                    <td >I<sub>kn</sub> =  @i_k_n_m &ang; @deg_k_n </td>\\n                </tr>\\n            </table>            \\n            </div>\\n            \"},\"id\":\"1202\",\"type\":\"HoverTool\"},{\"attributes\":{},\"id\":\"1172\",\"type\":\"HelpTool\"},{\"attributes\":{\"callback\":null},\"id\":\"1149\",\"type\":\"DataRange1d\"},{\"attributes\":{},\"id\":\"1225\",\"type\":\"Selection\"},{\"attributes\":{\"source\":{\"id\":\"1194\",\"type\":\"ColumnDataSource\"}},\"id\":\"1199\",\"type\":\"CDSView\"},{\"attributes\":{\"plot\":null,\"text\":\"Results\"},\"id\":\"1146\",\"type\":\"Title\"},{\"attributes\":{\"data_source\":{\"id\":\"1194\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"1196\",\"type\":\"Circle\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"1197\",\"type\":\"Circle\"},\"selection_glyph\":null,\"view\":{\"id\":\"1199\",\"type\":\"CDSView\"}},\"id\":\"1198\",\"type\":\"GlyphRenderer\"},{\"attributes\":{},\"id\":\"1155\",\"type\":\"LinearScale\"},{\"attributes\":{},\"id\":\"1222\",\"type\":\"BasicTickFormatter\"},{\"attributes\":{\"formatter\":{\"id\":\"1222\",\"type\":\"BasicTickFormatter\"},\"plot\":{\"id\":\"1147\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1163\",\"type\":\"BasicTicker\"}},\"id\":\"1162\",\"type\":\"LinearAxis\"},{\"attributes\":{},\"id\":\"1227\",\"type\":\"Selection\"},{\"attributes\":{\"callback\":null,\"data\":{\"deg_1a\":[106.08012622584882,116.56505117707799,-116.56505117707799,90.0],\"deg_1b\":[-133.91987381937008,-90.0,75.96375653207353,-90.0],\"deg_1c\":[-13.919873756094846,0.0,-63.43494882292201,-90.0],\"deg_1n\":[-90.0,135.0,-90.0,0.0],\"deg_2a\":[-43.91987374704067,0.0,26.56505117707799,-90.0],\"deg_2b\":[76.08012618968411,0.0,-108.43494882292202,90.0],\"deg_2c\":[-163.91987379225958,0.0,180.0,-79.38034472384487],\"deg_2n\":[165.96375653207352,0.0,-66.37062226934319,-79.38034472384487],\"i_1a_m\":[2275.5415296532233,4.735058123106524e-22,4.735058123106524e-22,4.235164736271502e-22],\"i_1b_m\":[2275.541531518146,2.117582368135751e-22,4.365507887384641e-22,2.117582368135751e-22],\"i_1c_m\":[2275.54153214098,0.0,2.367529061553262e-22,2.117582368135751e-22],\"i_1n_m\":[1.1368683772161603e-13,2.994713704459715e-22,2.117582368135751e-22,0.0],\"i_2a_m\":[689.5580396030565,0.0,1.5152185993940876e-20,6.776263578034403e-21],\"i_2b_m\":[689.5580394143191,6.776263578034403e-21,2.1428426932230842e-20,6.776263578034403e-21],\"i_2c_m\":[689.5580401681847,6.3527471044072525e-21,8.470329472543003e-22,6.89434869366917e-21],\"i_2n_m\":[3.515571301265078e-13,1.3129010682441655e-20,1.4792794468556757e-20,6.89434869366917e-21],\"trafo_id\":[\"POImv-POI\",\"W1mv-W1lv\",\"W2mv-W2lv\",\"W3mv-W3lv\"],\"x_s\":[[0.0,100.0],[-1500.0,-1500.0],[-1000.0,-1000.0],[-500.0,-500.0]],\"y_s\":[[0.0,0.0],[180.0,200.0],[180.0,200.0],[180.0,200.0]]},\"selected\":{\"id\":\"1223\",\"type\":\"Selection\"},\"selection_policy\":{\"id\":\"1224\",\"type\":\"UnionRenderers\"}},\"id\":\"1182\",\"type\":\"ColumnDataSource\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"1186\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            transformer id = @trafo_id  \\n            <table border=\\\"5\\\">\\n                <tr >\\n                    <td>I<sub>1a</sub> =  @i_1a_m &ang; @deg_1a </td>\\n                    <td>I<sub>2a</sub> =  @i_2a_m &ang; @deg_2a </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>1b</sub> =  @i_1b_m &ang; @deg_1b </td>\\n                    <td >I<sub>2b</sub> =  @i_2b_m &ang; @deg_2b </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>1c</sub> =  @i_1c_m &ang; @deg_1c </td>\\n                    <td >I<sub>2c</sub> =  @i_2c_m &ang; @deg_2c </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>1n</sub> =  @i_1n_m &ang; @deg_1n </td>\\n                    <td >I<sub>2n</sub> =  @i_2n_m &ang; @deg_2n </td>\\n                </tr>\\n            </table>            \\n            </div>\\n            \"},\"id\":\"1200\",\"type\":\"HoverTool\"},{\"attributes\":{\"callback\":null,\"data\":{\"bus_id\":[\"W1lv\",\"W2lv\",\"W3lv\",\"W1mv\",\"W2mv\",\"W3mv\",\"POImv\",\"POI\",\"GRID\"],\"deg_an\":[\"-43.92\",\"-43.92\",\"-43.92\",\"-43.92\",\"-43.92\",\"-43.92\",\"-43.92\",\"38.96\",\"30.00\"],\"deg_bn\":[\"106.08\",\"106.08\",\"106.08\",\"-13.93\",\"-13.93\",\"-13.92\",\"-13.92\",\"158.96\",\"150.00\"],\"deg_cn\":[\"166.08\",\"166.08\",\"166.08\",\"-83.67\",\"-83.67\",\"-83.67\",\"147.85\",\"-81.04\",\"-90.00\"],\"deg_ng\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\"],\"p_a\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"7277.85\"],\"p_abc\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"21833.56\"],\"p_b\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"7277.85\"],\"p_c\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"7277.85\"],\"q_a\":[\"-0.00\",\"-0.00\",\"-0.00\",\"-0.00\",\"-0.00\",\"-0.00\",\"-0.00\",\"0.00\",\"25247.58\"],\"q_abc\":[\"0.00\",\"0.00\",\"0.00\",\"-0.00\",\"-0.00\",\"-0.00\",\"0.00\",\"0.00\",\"75742.75\"],\"q_b\":[\"0.00\",\"0.00\",\"0.00\",\"-0.00\",\"-0.00\",\"-0.00\",\"-0.00\",\"0.00\",\"25247.58\"],\"q_c\":[\"0.00\",\"0.00\",\"0.00\",\"-0.00\",\"-0.00\",\"-0.00\",\"0.00\",\"-0.00\",\"25247.58\"],\"s_color\":[\"blue\",\"blue\",\"blue\",\"blue\",\"blue\",\"blue\",\"blue\",\"blue\",\"red\"],\"s_radio\":[1,1,1,1,1,1,1,1,20],\"u_avg_pu\":[\"0.000\",\"0.000\",\"0.000\",\"0.000\",\"0.000\",\"0.000\",\"0.000\",\"0.636\",\"1.000\"],\"v_ab\":[1.199216870256e-06,1.1992151926080004e-06,1.1992101525322997e-06,2.2755702174022945e-05,2.2755670349923454e-05,2.2755574722182132e-05,2.2755415291864846e-05,41944.594808228736,65999.79602241208],\"v_an\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"24216.72\",\"38105.00\"],\"v_an_pu\":[\"0.0000\",\"0.0000\",\"0.0000\",\"0.0000\",\"0.0000\",\"0.0000\",\"0.0000\",\"0.6355\",\"1.0000\"],\"v_bc\":[4.532613670847953e-07,4.5326073489986026e-07,4.532588318367175e-07,2.275570209073808e-05,2.2755670300272337e-05,2.275557470616546e-05,2.2755415309483745e-05,41944.59479728171,65999.79602241208],\"v_bn\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"24216.72\",\"38105.00\"],\"v_bn_pu\":[\"0.0000\",\"0.0000\",\"0.0000\",\"0.0000\",\"0.0000\",\"0.0000\",\"0.0000\",\"0.6355\",\"1.0000\"],\"v_ca\":[1.199216868374965e-06,1.1992151914866027e-06,1.1992101521705546e-06,3.9414032366776325e-05,3.941397723520462e-05,3.9413811592484065e-05,3.941353544046141e-05,41944.59477957205,65999.79602241208],\"v_cn\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"24216.72\",\"38105.00\"],\"v_cn_pu\":[\"0.0000\",\"0.0000\",\"0.0000\",\"0.0000\",\"0.0000\",\"0.0000\",\"0.0000\",\"0.6355\",\"1.0000\"],\"v_ng\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\"],\"v_unb\":[\"39.2\",\"39.2\",\"39.2\",\"100.0\",\"100.0\",\"100.0\",\"100.0\",\"0.0\",\"0.0\"],\"x\":[-1500.0,-1000.0,-500.0,-1500.0,-1000.0,-500.0,0.0,100.0,500.0],\"y\":[200.0,200.0,200.0,180.0,180.0,180.0,0.0,0.0,0.0]},\"selected\":{\"id\":\"1227\",\"type\":\"Selection\"},\"selection_policy\":{\"id\":\"1228\",\"type\":\"UnionRenderers\"}},\"id\":\"1194\",\"type\":\"ColumnDataSource\"},{\"attributes\":{},\"id\":\"1168\",\"type\":\"WheelZoomTool\"},{\"attributes\":{},\"id\":\"1226\",\"type\":\"UnionRenderers\"},{\"attributes\":{},\"id\":\"1170\",\"type\":\"SaveTool\"},{\"attributes\":{\"plot\":{\"id\":\"1147\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1158\",\"type\":\"BasicTicker\"}},\"id\":\"1161\",\"type\":\"Grid\"},{\"attributes\":{\"fill_alpha\":{\"value\":0.5},\"fill_color\":{\"value\":\"navy\"},\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"navy\"},\"size\":{\"units\":\"screen\",\"value\":15},\"x\":{\"field\":\"x\"},\"y\":{\"field\":\"y\"}},\"id\":\"1196\",\"type\":\"Circle\"},{\"attributes\":{\"overlay\":{\"id\":\"1175\",\"type\":\"BoxAnnotation\"}},\"id\":\"1169\",\"type\":\"BoxZoomTool\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"1198\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            bus_id = @bus_id &nbsp &nbsp |  u<sub>avg</sub>= @u_avg_pu pu |  u<sub>unb</sub>= @v_unb %\\n            <table border=\\\"1\\\">\\n                <tr>\\n                <td>v<sub>an</sub> =  @v_an  &ang; @deg_an V </td> <td> S<sub>a</sub> = @p_a + j@q_a kVA</td>\\n                </tr>\\n                      <tr>\\n                      <td> </td> <td>v<sub>ab</sub>= @v_ab V</td>\\n                      </tr>\\n                <tr>\\n                <td>v<sub>bn</sub> = @v_bn &ang; @deg_bn V </td><td> S<sub>b</sub> = @p_b + j@q_b kVA</td>\\n                </tr>\\n                      <tr>\\n                      <td> </td><td>v<sub>bc</sub>= @v_bc V</td>\\n                      </tr>\\n                <tr>\\n                <td>v<sub>cn</sub>  = @v_cn &ang; @deg_cn V </td>  <td>S<sub>c</sub> = @p_c + j@q_c kVA </td>\\n                </tr> \\n                    <tr>\\n                     <td> </td> <td>v<sub>ca</sub>= @v_ca V</td>\\n                    </tr>\\n               <tr>\\n                <td>v<sub>ng</sub>    = @v_ng &ang; @deg_ng V</td>  <td>S<sub>abc</sub> = @p_abc + j@q_abc kVA </td>\\n              </tr>\\n            </table>\\n            </div>\\n            \"},\"id\":\"1204\",\"type\":\"HoverTool\"},{\"attributes\":{\"callback\":null},\"id\":\"1151\",\"type\":\"DataRange1d\"}],\"root_ids\":[\"1147\"]},\"title\":\"Bokeh Application\",\"version\":\"1.0.1\"}};\n",
       "  var render_items = [{\"docid\":\"1dcf70e0-48f3-47d0-bed1-e028de2f1e33\",\"roots\":{\"1147\":\"bdb87cbf-cef3-4aaa-b133-51ae5cdcf883\"}}];\n",
       "  root.Bokeh.embed.embed_items_notebook(docs_json, render_items);\n",
       "\n",
       "  }\n",
       "  if (root.Bokeh !== undefined) {\n",
       "    embed_document(root);\n",
       "  } else {\n",
       "    var attempts = 0;\n",
       "    var timer = setInterval(function(root) {\n",
       "      if (root.Bokeh !== undefined) {\n",
       "        embed_document(root);\n",
       "        clearInterval(timer);\n",
       "      }\n",
       "      attempts++;\n",
       "      if (attempts > 100) {\n",
       "        console.log(\"Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing\");\n",
       "        clearInterval(timer);\n",
       "      }\n",
       "    }, 10, root)\n",
       "  }\n",
       "})(window);"
      ],
      "application/vnd.bokehjs_exec.v0+json": ""
     },
     "metadata": {
      "application/vnd.bokehjs_exec.v0+json": {
       "id": "1147"
      }
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "data['shunts'] = [ # three phase fault to ground\n",
    "                 {\"bus\": \"POImv\" , \"R\":1.0e-8, \"X\": 0.0, \"bus_nodes\": [1,2]},\n",
    "                 {\"bus\": \"POImv\" , \"R\":1.0e-8, \"X\": 0.0, \"bus_nodes\": [2,3]},\n",
    "                 {\"bus\": \"POImv\" , \"R\":1.0e-8, \"X\": 0.0, \"bus_nodes\": [3,0]},\n",
    "                 ]\n",
    "\n",
    "# powers to zero:\n",
    "data['grid_feeders'] = [{\"bus\": \"W1lv\",\"bus_nodes\": [1, 2, 3],\"kW\": 0, \"kvar\": 0},\n",
    "                        {\"bus\": \"W2lv\",\"bus_nodes\": [1, 2, 3],\"kW\": 0, \"kvar\": 0},\n",
    "                        {\"bus\": \"W3lv\",\"bus_nodes\": [1, 2, 3],\"kW\": 0, \"kvar\": 0},\n",
    "                        {\"bus\": \"POImv\",\"bus_nodes\": [1, 2, 3],\"kW\":0, \"kvar\": 0}] # STATCOM\n",
    "\n",
    "grid_1 = grid()\n",
    "grid_1.read(data) \n",
    "grid_1.pf() \n",
    "\n",
    "p=plot_results(grid_1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Three phase short circuit current at POImv = 2.28 kA\n"
     ]
    }
   ],
   "source": [
    "I_cc = grid_1.transformers[0]['i_1a_m']\n",
    "print('Three phase short circuit current at POImv = {:0.2f} kA'.format(I_cc/1000))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Phase-ground W1mv bus"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "\n",
       "\n",
       "\n",
       "\n",
       "\n",
       "\n",
       "  <div class=\"bk-root\" id=\"a65c7074-f20b-4526-b6b5-b3e2023f3628\"></div>\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/javascript": [
       "(function(root) {\n",
       "  function embed_document(root) {\n",
       "    \n",
       "  var docs_json = {\"eecbcf48-f7ee-4d0c-b441-f903d5dd25d6\":{\"roots\":{\"references\":[{\"attributes\":{\"below\":[{\"id\":\"1313\",\"type\":\"LinearAxis\"}],\"left\":[{\"id\":\"1318\",\"type\":\"LinearAxis\"}],\"plot_height\":400,\"renderers\":[{\"id\":\"1313\",\"type\":\"LinearAxis\"},{\"id\":\"1317\",\"type\":\"Grid\"},{\"id\":\"1318\",\"type\":\"LinearAxis\"},{\"id\":\"1322\",\"type\":\"Grid\"},{\"id\":\"1331\",\"type\":\"BoxAnnotation\"},{\"id\":\"1342\",\"type\":\"GlyphRenderer\"},{\"id\":\"1348\",\"type\":\"GlyphRenderer\"},{\"id\":\"1354\",\"type\":\"GlyphRenderer\"}],\"title\":{\"id\":\"1302\",\"type\":\"Title\"},\"toolbar\":{\"id\":\"1329\",\"type\":\"Toolbar\"},\"x_range\":{\"id\":\"1305\",\"type\":\"DataRange1d\"},\"x_scale\":{\"id\":\"1309\",\"type\":\"LinearScale\"},\"y_range\":{\"id\":\"1307\",\"type\":\"DataRange1d\"},\"y_scale\":{\"id\":\"1311\",\"type\":\"LinearScale\"}},\"id\":\"1303\",\"subtype\":\"Figure\",\"type\":\"Plot\"},{\"attributes\":{},\"id\":\"1314\",\"type\":\"BasicTicker\"},{\"attributes\":{\"plot\":{\"id\":\"1303\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1314\",\"type\":\"BasicTicker\"}},\"id\":\"1317\",\"type\":\"Grid\"},{\"attributes\":{},\"id\":\"1391\",\"type\":\"Selection\"},{\"attributes\":{\"formatter\":{\"id\":\"1388\",\"type\":\"BasicTickFormatter\"},\"plot\":{\"id\":\"1303\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1314\",\"type\":\"BasicTicker\"}},\"id\":\"1313\",\"type\":\"LinearAxis\"},{\"attributes\":{\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"green\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1340\",\"type\":\"MultiLine\"},{\"attributes\":{},\"id\":\"1311\",\"type\":\"LinearScale\"},{\"attributes\":{\"active_drag\":\"auto\",\"active_inspect\":\"auto\",\"active_multi\":null,\"active_scroll\":\"auto\",\"active_tap\":\"auto\",\"tools\":[{\"id\":\"1323\",\"type\":\"PanTool\"},{\"id\":\"1324\",\"type\":\"WheelZoomTool\"},{\"id\":\"1325\",\"type\":\"BoxZoomTool\"},{\"id\":\"1326\",\"type\":\"SaveTool\"},{\"id\":\"1327\",\"type\":\"ResetTool\"},{\"id\":\"1328\",\"type\":\"HelpTool\"},{\"id\":\"1356\",\"type\":\"HoverTool\"},{\"id\":\"1358\",\"type\":\"HoverTool\"},{\"id\":\"1360\",\"type\":\"HoverTool\"}]},\"id\":\"1329\",\"type\":\"Toolbar\"},{\"attributes\":{\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1341\",\"type\":\"MultiLine\"},{\"attributes\":{},\"id\":\"1394\",\"type\":\"UnionRenderers\"},{\"attributes\":{},\"id\":\"1319\",\"type\":\"BasicTicker\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"1342\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            transformer id = @trafo_id  \\n            <table border=\\\"5\\\">\\n                <tr >\\n                    <td>I<sub>1a</sub> =  @i_1a_m &ang; @deg_1a </td>\\n                    <td>I<sub>2a</sub> =  @i_2a_m &ang; @deg_2a </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>1b</sub> =  @i_1b_m &ang; @deg_1b </td>\\n                    <td >I<sub>2b</sub> =  @i_2b_m &ang; @deg_2b </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>1c</sub> =  @i_1c_m &ang; @deg_1c </td>\\n                    <td >I<sub>2c</sub> =  @i_2c_m &ang; @deg_2c </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>1n</sub> =  @i_1n_m &ang; @deg_1n </td>\\n                    <td >I<sub>2n</sub> =  @i_2n_m &ang; @deg_2n </td>\\n                </tr>\\n            </table>            \\n            </div>\\n            \"},\"id\":\"1356\",\"type\":\"HoverTool\"},{\"attributes\":{\"dimension\":1,\"plot\":{\"id\":\"1303\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1319\",\"type\":\"BasicTicker\"}},\"id\":\"1322\",\"type\":\"Grid\"},{\"attributes\":{\"callback\":null},\"id\":\"1305\",\"type\":\"DataRange1d\"},{\"attributes\":{\"callback\":null,\"data\":{\"deg_1a\":[164.45190803547396,-21.123947140122077,112.83365417791754,-118.96766064606402],\"deg_1b\":[-15.471136935952169,54.19043961127397,-59.52450011938357,55.38588712124751],\"deg_1c\":[-15.62581669196749,-121.03888764199871,174.16050768848257,91.02303018866785],\"deg_1n\":[90.0,0.0,0.0,63.43494882292201],\"deg_2a\":[-15.57391413053428,-159.90454575863075,-64.37800405539302,30.19162296095761],\"deg_2b\":[164.47764468112953,136.74651101213502,70.28196102962032,-103.47315811273114],\"deg_2c\":[-0.3713605762677789,135.0,-90.0,180.0],\"deg_2n\":[45.0,153.434948822922,0.0,-116.56505117707799],\"i_1a_m\":[622.0055351832189,7.963809139197742e-14,2.3803347352315634e-13,1.1370071466249427e-13],\"i_1b_m\":[312.550626093661,2.2797560630310777e-13,2.5918417478740246e-13,1.9857293961532692e-13],\"i_1c_m\":[309.45547574038903,1.8227918402458076e-13,3.9283700765566935e-14,4.974592103558154e-14],\"i_1n_m\":[4.547473508864641e-13,1.1368683772161603e-13,0.0,1.2710574864626038e-13],\"i_2a_m\":[162.96338049080813,2.789179233678185e-12,3.089088118901245e-12,3.617046393158724e-12],\"i_2b_m\":[163.50489180496547,1.3985441173256513e-12,6.823400751684223e-12,5.611398510136969e-12],\"i_2c_m\":[0.5610802236533374,5.1448789686149945e-12,3.637978807091713e-12,3.637978807091713e-12],\"i_2n_m\":[3.2155493553843715e-13,8.134767913360665e-12,3.637978807091713e-12,4.067383956680332e-12],\"trafo_id\":[\"POImv-POI\",\"W1mv-W1lv\",\"W2mv-W2lv\",\"W3mv-W3lv\"],\"x_s\":[[0.0,100.0],[-1500.0,-1500.0],[-1000.0,-1000.0],[-500.0,-500.0]],\"y_s\":[[0.0,0.0],[180.0,200.0],[180.0,200.0],[180.0,200.0]]},\"selected\":{\"id\":\"1391\",\"type\":\"Selection\"},\"selection_policy\":{\"id\":\"1392\",\"type\":\"UnionRenderers\"}},\"id\":\"1338\",\"type\":\"ColumnDataSource\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"1354\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            bus_id = @bus_id &nbsp &nbsp |  u<sub>avg</sub>= @u_avg_pu pu |  u<sub>unb</sub>= @v_unb %\\n            <table border=\\\"1\\\">\\n                <tr>\\n                <td>v<sub>an</sub> =  @v_an  &ang; @deg_an V </td> <td> S<sub>a</sub> = @p_a + j@q_a kVA</td>\\n                </tr>\\n                      <tr>\\n                      <td> </td> <td>v<sub>ab</sub>= @v_ab V</td>\\n                      </tr>\\n                <tr>\\n                <td>v<sub>bn</sub> = @v_bn &ang; @deg_bn V </td><td> S<sub>b</sub> = @p_b + j@q_b kVA</td>\\n                </tr>\\n                      <tr>\\n                      <td> </td><td>v<sub>bc</sub>= @v_bc V</td>\\n                      </tr>\\n                <tr>\\n                <td>v<sub>cn</sub>  = @v_cn &ang; @deg_cn V </td>  <td>S<sub>c</sub> = @p_c + j@q_c kVA </td>\\n                </tr> \\n                    <tr>\\n                     <td> </td> <td>v<sub>ca</sub>= @v_ca V</td>\\n                    </tr>\\n               <tr>\\n                <td>v<sub>ng</sub>    = @v_ng &ang; @deg_ng V</td>  <td>S<sub>abc</sub> = @p_abc + j@q_abc kVA </td>\\n              </tr>\\n            </table>\\n            </div>\\n            \"},\"id\":\"1360\",\"type\":\"HoverTool\"},{\"attributes\":{\"fill_alpha\":{\"value\":0.1},\"fill_color\":{\"value\":\"#1f77b4\"},\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"size\":{\"units\":\"screen\",\"value\":15},\"x\":{\"field\":\"x\"},\"y\":{\"field\":\"y\"}},\"id\":\"1353\",\"type\":\"Circle\"},{\"attributes\":{\"callback\":null},\"id\":\"1307\",\"type\":\"DataRange1d\"},{\"attributes\":{},\"id\":\"1393\",\"type\":\"Selection\"},{\"attributes\":{},\"id\":\"1323\",\"type\":\"PanTool\"},{\"attributes\":{\"overlay\":{\"id\":\"1331\",\"type\":\"BoxAnnotation\"}},\"id\":\"1325\",\"type\":\"BoxZoomTool\"},{\"attributes\":{\"plot\":null,\"text\":\"Results\"},\"id\":\"1302\",\"type\":\"Title\"},{\"attributes\":{\"source\":{\"id\":\"1338\",\"type\":\"ColumnDataSource\"}},\"id\":\"1343\",\"type\":\"CDSView\"},{\"attributes\":{\"bottom_units\":\"screen\",\"fill_alpha\":{\"value\":0.5},\"fill_color\":{\"value\":\"lightgrey\"},\"left_units\":\"screen\",\"level\":\"overlay\",\"line_alpha\":{\"value\":1.0},\"line_color\":{\"value\":\"black\"},\"line_dash\":[4,4],\"line_width\":{\"value\":2},\"plot\":null,\"render_mode\":\"css\",\"right_units\":\"screen\",\"top_units\":\"screen\"},\"id\":\"1331\",\"type\":\"BoxAnnotation\"},{\"attributes\":{\"callback\":null,\"data\":{\"deg_j_a\":[164.3015031317781,164.23541024939726,164.17003587525699,164.4260858694656],\"deg_j_b\":[-35.163731274776715,59.967379269834396,59.84678581090482,-15.522355318870423],\"deg_j_c\":[17.91029754279711,90.5774122781645,90.51018011650186,179.6286394237241],\"deg_j_n\":[164.30150313177882,164.00334919524568,163.7069561917379,19.17144762224959],\"deg_k_a\":[164.23541024939854,164.1700358752564,164.10538058436768,164.4260858694656],\"deg_k_b\":[59.96737926725779,59.84678581133116,59.726189538205986,-15.522355318870423],\"deg_k_c\":[90.57741227896436,90.51018011578707,90.44319045332256,179.6286394237241],\"deg_k_n\":[164.00334919525082,163.7069561917346,163.41232503282205,19.17144762224959],\"i_j_a_m\":[932.9993624861644,932.994249950984,932.9808079793052,162.96338049080836],\"i_j_b_m\":[8.804501402140932e-11,2.0992617341675714,4.191968585926717,163.50489180496604],\"i_j_c_m\":[3.1718838418536494e-11,1.8177700774436656,3.625396868272004,0.561080223652695],\"i_j_n_m\":[932.999362486055,932.9959884729799,932.9941864266358,9.21404812695079e-13],\"i_k_a_m\":[932.9942499509908,932.9808079793273,932.959044353799,162.96338049080836],\"i_k_b_m\":[2.0992617340761615,4.191968585964924,6.2780969090255745,163.50489180496604],\"i_k_c_m\":[1.8177700775015448,3.6253968682573445,5.422860827206212,0.561080223652695],\"i_k_n_m\":[932.9959884729581,932.9941864266317,932.9936595940051,9.21404812695079e-13],\"line_id\":[\"W1mv-W2mv\",\"W2mv-W3mv\",\"W3mv-POImv\",\"POI-GRID\"],\"x_s\":[[-1500.0,-1000.0],[-1000.0,-500.0],[-500.0,0.0],[100.0,500.0]],\"y_s\":[[180.0,180.0],[180.0,180.0],[180.0,0.0],[0.0,0.0]]},\"selected\":{\"id\":\"1393\",\"type\":\"Selection\"},\"selection_policy\":{\"id\":\"1394\",\"type\":\"UnionRenderers\"}},\"id\":\"1344\",\"type\":\"ColumnDataSource\"},{\"attributes\":{},\"id\":\"1396\",\"type\":\"UnionRenderers\"},{\"attributes\":{},\"id\":\"1388\",\"type\":\"BasicTickFormatter\"},{\"attributes\":{},\"id\":\"1326\",\"type\":\"SaveTool\"},{\"attributes\":{},\"id\":\"1309\",\"type\":\"LinearScale\"},{\"attributes\":{\"callback\":null,\"data\":{\"bus_id\":[\"W1lv\",\"W2lv\",\"W3lv\",\"W1mv\",\"W2mv\",\"W3mv\",\"POImv\",\"POI\",\"GRID\"],\"deg_an\":[\"21.91\",\"21.92\",\"21.93\",\"-15.70\",\"23.58\",\"23.51\",\"23.43\",\"28.67\",\"30.00\"],\"deg_bn\":[\"135.98\",\"136.18\",\"136.38\",\"135.98\",\"135.84\",\"135.71\",\"135.58\",\"144.86\",\"150.00\"],\"deg_cn\":[\"-90.01\",\"-90.01\",\"-90.01\",\"-158.09\",\"-158.10\",\"-158.10\",\"-158.10\",\"-90.01\",\"-90.00\"],\"deg_ng\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\"],\"p_a\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"4346.73\"],\"p_abc\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"10379.38\"],\"p_b\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"6032.51\"],\"p_c\":[\"-0.00\",\"-0.00\",\"-0.00\",\"-0.00\",\"-0.00\",\"-0.00\",\"-0.00\",\"-0.00\",\"0.14\"],\"q_a\":[\"0.00\",\"0.00\",\"0.00\",\"-0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"4434.70\"],\"q_abc\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"2855.71\"],\"q_b\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"-1557.60\"],\"q_c\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"-21.38\"],\"s_color\":[\"blue\",\"blue\",\"blue\",\"blue\",\"blue\",\"blue\",\"blue\",\"blue\",\"red\"],\"s_radio\":[1,1,1,1,1,1,1,1,20],\"u_avg_pu\":[\"0.935\",\"0.937\",\"0.939\",\"1.042\",\"1.044\",\"1.046\",\"1.047\",\"0.963\",\"1.000\"],\"v_ab\":[605.3671559316309,607.7464925279803,610.130367951231,20336.198130868288,20365.618416003137,20395.23202664299,20425.038277512067,61146.01156402631,65999.79602241208],\"v_an\":[\"314.05\",\"315.59\",\"317.13\",\"0.00\",\"128.72\",\"257.44\",\"386.15\",\"34741.34\",\"38105.00\"],\"v_an_pu\":[\"0.7883\",\"0.7922\",\"0.7961\",\"0.0000\",\"0.0111\",\"0.0223\",\"0.0334\",\"0.9117\",\"1.0000\"],\"v_bc\":[739.8867908378849,739.8742241243722,739.8627918656485,20015.798591065217,20015.77053023141,20015.68634804249,20015.546045436065,66904.84623503049,65999.79602241208],\"v_bn\":[\"405.07\",\"405.65\",\"406.24\",\"20336.20\",\"20316.51\",\"20296.55\",\"20276.31\",\"37267.16\",\"38105.00\"],\"v_bn_pu\":[\"1.0168\",\"1.0183\",\"1.0198\",\"1.7612\",\"1.7595\",\"1.7577\",\"1.7560\",\"0.9780\",\"1.0000\"],\"v_ca\":[592.5208312679343,593.7514029649193,594.981732508194,15766.874371036702,15844.048379189795,15921.178328142565,15998.26401282201,62694.63372744478,65999.79602241208],\"v_cn\":[\"398.69\",\"398.69\",\"398.68\",\"15766.87\",\"15715.38\",\"15663.84\",\"15612.24\",\"38115.20\",\"38105.00\"],\"v_cn_pu\":[\"1.0008\",\"1.0008\",\"1.0008\",\"1.3655\",\"1.3610\",\"1.3565\",\"1.3521\",\"1.0003\",\"1.0000\"],\"v_ng\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\"],\"v_unb\":[\"15.7\",\"15.5\",\"15.2\",\"100.0\",\"98.9\",\"97.9\",\"96.8\",\"5.4\",\"0.0\"],\"x\":[-1500.0,-1000.0,-500.0,-1500.0,-1000.0,-500.0,0.0,100.0,500.0],\"y\":[200.0,200.0,200.0,180.0,180.0,180.0,0.0,0.0,0.0]},\"selected\":{\"id\":\"1395\",\"type\":\"Selection\"},\"selection_policy\":{\"id\":\"1396\",\"type\":\"UnionRenderers\"}},\"id\":\"1350\",\"type\":\"ColumnDataSource\"},{\"attributes\":{\"data_source\":{\"id\":\"1338\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"1340\",\"type\":\"MultiLine\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"1341\",\"type\":\"MultiLine\"},\"selection_glyph\":null,\"view\":{\"id\":\"1343\",\"type\":\"CDSView\"}},\"id\":\"1342\",\"type\":\"GlyphRenderer\"},{\"attributes\":{\"data_source\":{\"id\":\"1344\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"1346\",\"type\":\"MultiLine\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"1347\",\"type\":\"MultiLine\"},\"selection_glyph\":null,\"view\":{\"id\":\"1349\",\"type\":\"CDSView\"}},\"id\":\"1348\",\"type\":\"GlyphRenderer\"},{\"attributes\":{},\"id\":\"1390\",\"type\":\"BasicTickFormatter\"},{\"attributes\":{},\"id\":\"1324\",\"type\":\"WheelZoomTool\"},{\"attributes\":{\"source\":{\"id\":\"1344\",\"type\":\"ColumnDataSource\"}},\"id\":\"1349\",\"type\":\"CDSView\"},{\"attributes\":{},\"id\":\"1395\",\"type\":\"Selection\"},{\"attributes\":{},\"id\":\"1327\",\"type\":\"ResetTool\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"1348\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            line id = @line_id \\n            <table border=\\\"5\\\">\\n                <tr >\\n                    <td>I<sub>ja</sub> =  @i_j_a_m &ang; @deg_j_a </td>\\n                    <td>I<sub>ka</sub> =  @i_k_a_m &ang; @deg_k_a </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>jb</sub> =  @i_j_b_m &ang; @deg_j_b </td>\\n                    <td >I<sub>kb</sub> =  @i_k_b_m &ang; @deg_k_b </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>jc</sub> =  @i_j_c_m &ang; @deg_j_c </td>\\n                    <td >I<sub>kc</sub> =  @i_k_c_m &ang; @deg_k_c </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>jn</sub> =  @i_j_n_m &ang; @deg_j_n </td>\\n                    <td >I<sub>kn</sub> =  @i_k_n_m &ang; @deg_k_n </td>\\n                </tr>\\n            </table>            \\n            </div>\\n            \"},\"id\":\"1358\",\"type\":\"HoverTool\"},{\"attributes\":{\"formatter\":{\"id\":\"1390\",\"type\":\"BasicTickFormatter\"},\"plot\":{\"id\":\"1303\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1319\",\"type\":\"BasicTicker\"}},\"id\":\"1318\",\"type\":\"LinearAxis\"},{\"attributes\":{\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1347\",\"type\":\"MultiLine\"},{\"attributes\":{\"fill_alpha\":{\"value\":0.5},\"fill_color\":{\"value\":\"navy\"},\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"navy\"},\"size\":{\"units\":\"screen\",\"value\":15},\"x\":{\"field\":\"x\"},\"y\":{\"field\":\"y\"}},\"id\":\"1352\",\"type\":\"Circle\"},{\"attributes\":{\"source\":{\"id\":\"1350\",\"type\":\"ColumnDataSource\"}},\"id\":\"1355\",\"type\":\"CDSView\"},{\"attributes\":{},\"id\":\"1328\",\"type\":\"HelpTool\"},{\"attributes\":{\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"red\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1346\",\"type\":\"MultiLine\"},{\"attributes\":{},\"id\":\"1392\",\"type\":\"UnionRenderers\"},{\"attributes\":{\"data_source\":{\"id\":\"1350\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"1352\",\"type\":\"Circle\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"1353\",\"type\":\"Circle\"},\"selection_glyph\":null,\"view\":{\"id\":\"1355\",\"type\":\"CDSView\"}},\"id\":\"1354\",\"type\":\"GlyphRenderer\"}],\"root_ids\":[\"1303\"]},\"title\":\"Bokeh Application\",\"version\":\"1.0.1\"}};\n",
       "  var render_items = [{\"docid\":\"eecbcf48-f7ee-4d0c-b441-f903d5dd25d6\",\"roots\":{\"1303\":\"a65c7074-f20b-4526-b6b5-b3e2023f3628\"}}];\n",
       "  root.Bokeh.embed.embed_items_notebook(docs_json, render_items);\n",
       "\n",
       "  }\n",
       "  if (root.Bokeh !== undefined) {\n",
       "    embed_document(root);\n",
       "  } else {\n",
       "    var attempts = 0;\n",
       "    var timer = setInterval(function(root) {\n",
       "      if (root.Bokeh !== undefined) {\n",
       "        embed_document(root);\n",
       "        clearInterval(timer);\n",
       "      }\n",
       "      attempts++;\n",
       "      if (attempts > 100) {\n",
       "        console.log(\"Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing\");\n",
       "        clearInterval(timer);\n",
       "      }\n",
       "    }, 10, root)\n",
       "  }\n",
       "})(window);"
      ],
      "application/vnd.bokehjs_exec.v0+json": ""
     },
     "metadata": {
      "application/vnd.bokehjs_exec.v0+json": {
       "id": "1303"
      }
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "data['shunts'] = [\n",
    "                 {\"bus\": \"W1mv\" , \"R\": 1.0e-8, \"X\": 0.0, \"bus_nodes\": [1,0]},\n",
    "                 ]\n",
    "grid_1 = grid()\n",
    "grid_1.read(data)  # Load data\n",
    "grid_1.pf() \n",
    "\n",
    "p=plot_results(grid_1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Phase-ground short circuit current at W1mv = 0.62 kA\n"
     ]
    }
   ],
   "source": [
    "I_cc = grid_1.transformers[0]['i_1a_m']\n",
    "print('Phase-ground short circuit current at W1mv = {:0.2f} kA'.format(I_cc/1000))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Get POI voltage with generators reactive powers"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "\n",
       "\n",
       "\n",
       "\n",
       "\n",
       "\n",
       "  <div class=\"bk-root\" id=\"b3d78409-86e8-42cc-bc0b-31ffc4637478\"></div>\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/javascript": [
       "(function(root) {\n",
       "  function embed_document(root) {\n",
       "    \n",
       "  var docs_json = {\"1569be0f-8c6c-41b7-8903-9ccb1e11956f\":{\"roots\":{\"references\":[{\"attributes\":{\"below\":[{\"id\":\"1481\",\"type\":\"LinearAxis\"}],\"left\":[{\"id\":\"1486\",\"type\":\"LinearAxis\"}],\"plot_height\":400,\"renderers\":[{\"id\":\"1481\",\"type\":\"LinearAxis\"},{\"id\":\"1485\",\"type\":\"Grid\"},{\"id\":\"1486\",\"type\":\"LinearAxis\"},{\"id\":\"1490\",\"type\":\"Grid\"},{\"id\":\"1499\",\"type\":\"BoxAnnotation\"},{\"id\":\"1510\",\"type\":\"GlyphRenderer\"},{\"id\":\"1516\",\"type\":\"GlyphRenderer\"},{\"id\":\"1522\",\"type\":\"GlyphRenderer\"}],\"title\":{\"id\":\"1470\",\"type\":\"Title\"},\"toolbar\":{\"id\":\"1497\",\"type\":\"Toolbar\"},\"x_range\":{\"id\":\"1473\",\"type\":\"DataRange1d\"},\"x_scale\":{\"id\":\"1477\",\"type\":\"LinearScale\"},\"y_range\":{\"id\":\"1475\",\"type\":\"DataRange1d\"},\"y_scale\":{\"id\":\"1479\",\"type\":\"LinearScale\"}},\"id\":\"1471\",\"subtype\":\"Figure\",\"type\":\"Plot\"},{\"attributes\":{},\"id\":\"1572\",\"type\":\"UnionRenderers\"},{\"attributes\":{\"fill_alpha\":{\"value\":0.5},\"fill_color\":{\"value\":\"navy\"},\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"navy\"},\"size\":{\"units\":\"screen\",\"value\":15},\"x\":{\"field\":\"x\"},\"y\":{\"field\":\"y\"}},\"id\":\"1520\",\"type\":\"Circle\"},{\"attributes\":{},\"id\":\"1574\",\"type\":\"UnionRenderers\"},{\"attributes\":{\"active_drag\":\"auto\",\"active_inspect\":\"auto\",\"active_multi\":null,\"active_scroll\":\"auto\",\"active_tap\":\"auto\",\"tools\":[{\"id\":\"1491\",\"type\":\"PanTool\"},{\"id\":\"1492\",\"type\":\"WheelZoomTool\"},{\"id\":\"1493\",\"type\":\"BoxZoomTool\"},{\"id\":\"1494\",\"type\":\"SaveTool\"},{\"id\":\"1495\",\"type\":\"ResetTool\"},{\"id\":\"1496\",\"type\":\"HelpTool\"},{\"id\":\"1524\",\"type\":\"HoverTool\"},{\"id\":\"1526\",\"type\":\"HoverTool\"},{\"id\":\"1528\",\"type\":\"HoverTool\"}]},\"id\":\"1497\",\"type\":\"Toolbar\"},{\"attributes\":{\"plot\":null,\"text\":\"Results\"},\"id\":\"1470\",\"type\":\"Title\"},{\"attributes\":{},\"id\":\"1477\",\"type\":\"LinearScale\"},{\"attributes\":{\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1515\",\"type\":\"MultiLine\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"1522\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            bus_id = @bus_id &nbsp &nbsp |  u<sub>avg</sub>= @u_avg_pu pu |  u<sub>unb</sub>= @v_unb %\\n            <table border=\\\"1\\\">\\n                <tr>\\n                <td>v<sub>an</sub> =  @v_an  &ang; @deg_an V </td> <td> S<sub>a</sub> = @p_a + j@q_a kVA</td>\\n                </tr>\\n                      <tr>\\n                      <td> </td> <td>v<sub>ab</sub>= @v_ab V</td>\\n                      </tr>\\n                <tr>\\n                <td>v<sub>bn</sub> = @v_bn &ang; @deg_bn V </td><td> S<sub>b</sub> = @p_b + j@q_b kVA</td>\\n                </tr>\\n                      <tr>\\n                      <td> </td><td>v<sub>bc</sub>= @v_bc V</td>\\n                      </tr>\\n                <tr>\\n                <td>v<sub>cn</sub>  = @v_cn &ang; @deg_cn V </td>  <td>S<sub>c</sub> = @p_c + j@q_c kVA </td>\\n                </tr> \\n                    <tr>\\n                     <td> </td> <td>v<sub>ca</sub>= @v_ca V</td>\\n                    </tr>\\n               <tr>\\n                <td>v<sub>ng</sub>    = @v_ng &ang; @deg_ng V</td>  <td>S<sub>abc</sub> = @p_abc + j@q_abc kVA </td>\\n              </tr>\\n            </table>\\n            </div>\\n            \"},\"id\":\"1528\",\"type\":\"HoverTool\"},{\"attributes\":{},\"id\":\"1491\",\"type\":\"PanTool\"},{\"attributes\":{},\"id\":\"1573\",\"type\":\"Selection\"},{\"attributes\":{},\"id\":\"1570\",\"type\":\"BasicTickFormatter\"},{\"attributes\":{},\"id\":\"1575\",\"type\":\"Selection\"},{\"attributes\":{},\"id\":\"1568\",\"type\":\"BasicTickFormatter\"},{\"attributes\":{},\"id\":\"1492\",\"type\":\"WheelZoomTool\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"1516\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            line id = @line_id \\n            <table border=\\\"5\\\">\\n                <tr >\\n                    <td>I<sub>ja</sub> =  @i_j_a_m &ang; @deg_j_a </td>\\n                    <td>I<sub>ka</sub> =  @i_k_a_m &ang; @deg_k_a </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>jb</sub> =  @i_j_b_m &ang; @deg_j_b </td>\\n                    <td >I<sub>kb</sub> =  @i_k_b_m &ang; @deg_k_b </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>jc</sub> =  @i_j_c_m &ang; @deg_j_c </td>\\n                    <td >I<sub>kc</sub> =  @i_k_c_m &ang; @deg_k_c </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>jn</sub> =  @i_j_n_m &ang; @deg_j_n </td>\\n                    <td >I<sub>kn</sub> =  @i_k_n_m &ang; @deg_k_n </td>\\n                </tr>\\n            </table>            \\n            </div>\\n            \"},\"id\":\"1526\",\"type\":\"HoverTool\"},{\"attributes\":{},\"id\":\"1576\",\"type\":\"UnionRenderers\"},{\"attributes\":{\"overlay\":{\"id\":\"1499\",\"type\":\"BoxAnnotation\"}},\"id\":\"1493\",\"type\":\"BoxZoomTool\"},{\"attributes\":{\"callback\":null,\"data\":{\"deg_1a\":[31.908892967113736,-147.59004426028082,-147.6139758864561,-147.6617616102617],\"deg_1b\":[151.90889377077752,-27.590043466133483,-27.61397509269839,-27.661760817297374],\"deg_1c\":[-88.09110597866994,92.40995679707316,92.38602516641873,92.33823943364312],\"deg_1n\":[-116.56505117707799,180.0,-90.0,135.0],\"deg_2a\":[-118.09110659796325,62.409960277584545,62.38602864008908,62.338242893549904],\"deg_2b\":[1.908893151484532,-177.59004444277716,-177.61397608151026,-177.66176183035535],\"deg_2c\":[121.90889420570055,-57.590046764148106,-57.61397837131491,-57.66176405711041],\"deg_2n\":[108.43494882292202,177.86682894474066,177.65090224331692,177.2158428677659],\"i_1a_m\":[196.01610637755783,65.60123508214791,65.61417457553279,65.64014038667084],\"i_1b_m\":[196.0161089547221,65.6012359550932,65.61417544298502,65.64014124312493],\"i_1c_m\":[196.0161052850593,65.60123473117399,65.61417422204323,65.6401400281581],\"i_1n_m\":[2.5421149729252077e-13,1.1368683772161603e-13,1.7053025658242404e-13,8.038873388460929e-14],\"i_2a_m\":[59.398819633384996,1901.4849948900423,1901.8600533517756,1902.6126869232971],\"i_2b_m\":[59.39882074540405,1901.485245244783,1901.8603023831306,1902.6129333054384],\"i_2c_m\":[59.39882041434408,1901.4849995293966,1901.8600570349763,1902.6126886974755],\"i_2n_m\":[5.392640207733813e-13,0.0004518407381401206,0.00045028063732552634,0.0004471678909263637],\"trafo_id\":[\"POImv-POI\",\"W1mv-W1lv\",\"W2mv-W2lv\",\"W3mv-W3lv\"],\"x_s\":[[0.0,100.0],[-1500.0,-1500.0],[-1000.0,-1000.0],[-500.0,-500.0]],\"y_s\":[[0.0,0.0],[180.0,200.0],[180.0,200.0],[180.0,200.0]]},\"selected\":{\"id\":\"1571\",\"type\":\"Selection\"},\"selection_policy\":{\"id\":\"1572\",\"type\":\"UnionRenderers\"}},\"id\":\"1506\",\"type\":\"ColumnDataSource\"},{\"attributes\":{},\"id\":\"1494\",\"type\":\"SaveTool\"},{\"attributes\":{\"callback\":null,\"data\":{\"bus_id\":[\"W1lv\",\"W2lv\",\"W3lv\",\"W1mv\",\"W2mv\",\"W3mv\",\"POImv\",\"POI\",\"GRID\"],\"deg_an\":[\"38.12\",\"38.10\",\"38.05\",\"5.00\",\"4.98\",\"4.93\",\"4.85\",\"31.90\",\"30.00\"],\"deg_bn\":[\"158.12\",\"158.10\",\"158.05\",\"125.00\",\"124.98\",\"124.93\",\"124.85\",\"151.90\",\"150.00\"],\"deg_cn\":[\"-81.88\",\"-81.90\",\"-81.95\",\"-115.00\",\"-115.02\",\"-115.07\",\"-115.15\",\"-88.10\",\"-90.00\"],\"deg_ng\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\"],\"p_a\":[\"666.67\",\"666.67\",\"666.67\",\"0.00\",\"0.00\",\"0.02\",\"0.00\",\"0.00\",\"-1921.37\"],\"p_abc\":[\"2000.00\",\"2000.00\",\"2000.00\",\"0.00\",\"0.00\",\"0.02\",\"0.00\",\"0.00\",\"-5764.11\"],\"p_b\":[\"666.67\",\"666.67\",\"666.67\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"-1921.37\"],\"p_c\":[\"666.67\",\"666.67\",\"666.67\",\"-0.00\",\"-0.00\",\"-0.00\",\"-0.00\",\"0.00\",\"-1921.37\"],\"q_a\":[\"-300.81\",\"-300.81\",\"-300.81\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"1196.36\"],\"q_abc\":[\"-902.42\",\"-902.42\",\"-902.42\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"3589.08\"],\"q_b\":[\"-300.81\",\"-300.81\",\"-300.81\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"1196.36\"],\"q_c\":[\"-300.81\",\"-300.81\",\"-300.81\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"-0.00\",\"1196.36\"],\"s_color\":[\"red\",\"red\",\"red\",\"blue\",\"blue\",\"red\",\"blue\",\"blue\",\"green\"],\"s_radio\":[14.81271237424267,14.8127123646333,14.812712345462266,1,1,1,1,1,20],\"u_avg_pu\":[\"0.966\",\"0.965\",\"0.965\",\"0.981\",\"0.981\",\"0.981\",\"0.980\",\"1.000\",\"1.000\"],\"v_ab\":[666.2168785740158,666.0854959252787,665.8220053214751,19622.687435678683,19618.9521166039,19611.46096377975,19600.22796111048,66000.00001691464,65999.79602241208],\"v_an\":[\"384.64\",\"384.56\",\"384.41\",\"11329.16\",\"11327.01\",\"11322.68\",\"11316.20\",\"38105.12\",\"38105.00\"],\"v_an_pu\":[\"0.9655\",\"0.9653\",\"0.9650\",\"0.9811\",\"0.9809\",\"0.9806\",\"0.9800\",\"1.0000\",\"1.0000\"],\"v_bc\":[666.216876989281,666.0854943433357,665.8220037451516,19622.687405273708,19618.95208638505,19611.460933932765,19600.22793182024,65999.9999866861,65999.79602241208],\"v_bn\":[\"384.64\",\"384.56\",\"384.41\",\"11329.16\",\"11327.01\",\"11322.68\",\"11316.20\",\"38105.12\",\"38105.00\"],\"v_bn_pu\":[\"0.9655\",\"0.9653\",\"0.9650\",\"0.9811\",\"0.9809\",\"0.9806\",\"0.9800\",\"1.0000\",\"1.0000\"],\"v_ca\":[666.2168768695187,666.0854942302402,665.8220036453523,19622.687433687155,19618.95211473619,19611.460962158602,19600.227959856475,65999.99997642843,65999.79602241208],\"v_cn\":[\"384.64\",\"384.56\",\"384.41\",\"11329.16\",\"11327.01\",\"11322.68\",\"11316.20\",\"38105.12\",\"38105.00\"],\"v_cn_pu\":[\"0.9655\",\"0.9653\",\"0.9650\",\"0.9811\",\"0.9809\",\"0.9806\",\"0.9800\",\"1.0000\",\"1.0000\"],\"v_ng\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\"],\"v_unb\":[\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\"],\"x\":[-1500.0,-1000.0,-500.0,-1500.0,-1000.0,-500.0,0.0,100.0,500.0],\"y\":[200.0,200.0,200.0,180.0,180.0,180.0,0.0,0.0,0.0]},\"selected\":{\"id\":\"1575\",\"type\":\"Selection\"},\"selection_policy\":{\"id\":\"1576\",\"type\":\"UnionRenderers\"}},\"id\":\"1518\",\"type\":\"ColumnDataSource\"},{\"attributes\":{\"data_source\":{\"id\":\"1512\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"1514\",\"type\":\"MultiLine\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"1515\",\"type\":\"MultiLine\"},\"selection_glyph\":null,\"view\":{\"id\":\"1517\",\"type\":\"CDSView\"}},\"id\":\"1516\",\"type\":\"GlyphRenderer\"},{\"attributes\":{\"source\":{\"id\":\"1518\",\"type\":\"ColumnDataSource\"}},\"id\":\"1523\",\"type\":\"CDSView\"},{\"attributes\":{\"fill_alpha\":{\"value\":0.1},\"fill_color\":{\"value\":\"#1f77b4\"},\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"size\":{\"units\":\"screen\",\"value\":15},\"x\":{\"field\":\"x\"},\"y\":{\"field\":\"y\"}},\"id\":\"1521\",\"type\":\"Circle\"},{\"attributes\":{},\"id\":\"1495\",\"type\":\"ResetTool\"},{\"attributes\":{},\"id\":\"1571\",\"type\":\"Selection\"},{\"attributes\":{\"source\":{\"id\":\"1506\",\"type\":\"ColumnDataSource\"}},\"id\":\"1511\",\"type\":\"CDSView\"},{\"attributes\":{},\"id\":\"1479\",\"type\":\"LinearScale\"},{\"attributes\":{},\"id\":\"1496\",\"type\":\"HelpTool\"},{\"attributes\":{\"formatter\":{\"id\":\"1568\",\"type\":\"BasicTickFormatter\"},\"plot\":{\"id\":\"1471\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1482\",\"type\":\"BasicTicker\"}},\"id\":\"1481\",\"type\":\"LinearAxis\"},{\"attributes\":{\"callback\":null},\"id\":\"1473\",\"type\":\"DataRange1d\"},{\"attributes\":{},\"id\":\"1482\",\"type\":\"BasicTicker\"},{\"attributes\":{\"bottom_units\":\"screen\",\"fill_alpha\":{\"value\":0.5},\"fill_color\":{\"value\":\"lightgrey\"},\"left_units\":\"screen\",\"level\":\"overlay\",\"line_alpha\":{\"value\":1.0},\"line_color\":{\"value\":\"black\"},\"line_dash\":[4,4],\"line_width\":{\"value\":2},\"plot\":null,\"render_mode\":\"css\",\"right_units\":\"screen\",\"top_units\":\"screen\"},\"id\":\"1499\",\"type\":\"BoxAnnotation\"},{\"attributes\":{\"plot\":{\"id\":\"1471\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1482\",\"type\":\"BasicTicker\"}},\"id\":\"1485\",\"type\":\"Grid\"},{\"attributes\":{\"formatter\":{\"id\":\"1570\",\"type\":\"BasicTickFormatter\"},\"plot\":{\"id\":\"1471\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1487\",\"type\":\"BasicTicker\"}},\"id\":\"1486\",\"type\":\"LinearAxis\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"1510\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            transformer id = @trafo_id  \\n            <table border=\\\"5\\\">\\n                <tr >\\n                    <td>I<sub>1a</sub> =  @i_1a_m &ang; @deg_1a </td>\\n                    <td>I<sub>2a</sub> =  @i_2a_m &ang; @deg_2a </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>1b</sub> =  @i_1b_m &ang; @deg_1b </td>\\n                    <td >I<sub>2b</sub> =  @i_2b_m &ang; @deg_2b </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>1c</sub> =  @i_1c_m &ang; @deg_1c </td>\\n                    <td >I<sub>2c</sub> =  @i_2c_m &ang; @deg_2c </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>1n</sub> =  @i_1n_m &ang; @deg_1n </td>\\n                    <td >I<sub>2n</sub> =  @i_2n_m &ang; @deg_2n </td>\\n                </tr>\\n            </table>            \\n            </div>\\n            \"},\"id\":\"1524\",\"type\":\"HoverTool\"},{\"attributes\":{\"source\":{\"id\":\"1512\",\"type\":\"ColumnDataSource\"}},\"id\":\"1517\",\"type\":\"CDSView\"},{\"attributes\":{\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1509\",\"type\":\"MultiLine\"},{\"attributes\":{},\"id\":\"1487\",\"type\":\"BasicTicker\"},{\"attributes\":{\"callback\":null,\"data\":{\"deg_j_a\":[32.40995573977892,32.162970706906584,32.06458078344749,61.908893402036895],\"deg_j_b\":[152.40995653390655,152.16297150586533,152.06458158375264,-178.09110684851592],\"deg_j_c\":[-87.59004320287264,-87.83702823657036,-87.9354181633008,-58.091105794298905],\"deg_j_n\":[165.47359547153744,107.22748061687568,83.85401199638233,59.4593951503185],\"deg_k_a\":[31.938929307538263,31.927105475564126,31.907388382783218,61.908893402036895],\"deg_k_b\":[151.9389301117496,151.9271062795587,151.90738918643407,-178.09110684851592],\"deg_k_c\":[-88.06106963228768,-88.07289346652799,-88.09261056305718,-58.091105794298905],\"deg_k_n\":[-14.142346642032694,106.99137036058065,83.43212057487115,59.4593951503185],\"i_j_a_m\":[65.60123508212315,130.93800422551658,196.3015535057179,59.398819633384925],\"i_j_b_m\":[65.60123595507442,130.93800595936216,196.30155608945702,59.39882074540426],\"i_j_c_m\":[65.60123473117173,130.9380035111505,196.3015524229718,59.398820414343945],\"i_j_n_m\":[1.1331238815153219e-13,4.9515151315032576e-11,3.295967223211031e-11,4.124974446133592e-13],\"i_k_a_m\":[65.3248262717119,130.6625379389066,196.026184050834,59.398819633384925],\"i_k_b_m\":[65.32482713806705,130.6625396661208,196.0261866279265,59.39882074540426],\"i_k_c_m\":[65.32482591082378,130.66253721460603,196.02618295818266,59.398820414343945],\"i_k_n_m\":[1.1632424986758356e-13,4.942266224270872e-11,3.290089294494184e-11,4.124974446133592e-13],\"line_id\":[\"W1mv-W2mv\",\"W2mv-W3mv\",\"W3mv-POImv\",\"POI-GRID\"],\"x_s\":[[-1500.0,-1000.0],[-1000.0,-500.0],[-500.0,0.0],[100.0,500.0]],\"y_s\":[[180.0,180.0],[180.0,180.0],[180.0,0.0],[0.0,0.0]]},\"selected\":{\"id\":\"1573\",\"type\":\"Selection\"},\"selection_policy\":{\"id\":\"1574\",\"type\":\"UnionRenderers\"}},\"id\":\"1512\",\"type\":\"ColumnDataSource\"},{\"attributes\":{\"dimension\":1,\"plot\":{\"id\":\"1471\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1487\",\"type\":\"BasicTicker\"}},\"id\":\"1490\",\"type\":\"Grid\"},{\"attributes\":{\"data_source\":{\"id\":\"1506\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"1508\",\"type\":\"MultiLine\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"1509\",\"type\":\"MultiLine\"},\"selection_glyph\":null,\"view\":{\"id\":\"1511\",\"type\":\"CDSView\"}},\"id\":\"1510\",\"type\":\"GlyphRenderer\"},{\"attributes\":{\"data_source\":{\"id\":\"1518\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"1520\",\"type\":\"Circle\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"1521\",\"type\":\"Circle\"},\"selection_glyph\":null,\"view\":{\"id\":\"1523\",\"type\":\"CDSView\"}},\"id\":\"1522\",\"type\":\"GlyphRenderer\"},{\"attributes\":{\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"red\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1514\",\"type\":\"MultiLine\"},{\"attributes\":{\"callback\":null},\"id\":\"1475\",\"type\":\"DataRange1d\"},{\"attributes\":{\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"green\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1508\",\"type\":\"MultiLine\"}],\"root_ids\":[\"1471\"]},\"title\":\"Bokeh Application\",\"version\":\"1.0.1\"}};\n",
       "  var render_items = [{\"docid\":\"1569be0f-8c6c-41b7-8903-9ccb1e11956f\",\"roots\":{\"1471\":\"b3d78409-86e8-42cc-bc0b-31ffc4637478\"}}];\n",
       "  root.Bokeh.embed.embed_items_notebook(docs_json, render_items);\n",
       "\n",
       "  }\n",
       "  if (root.Bokeh !== undefined) {\n",
       "    embed_document(root);\n",
       "  } else {\n",
       "    var attempts = 0;\n",
       "    var timer = setInterval(function(root) {\n",
       "      if (root.Bokeh !== undefined) {\n",
       "        embed_document(root);\n",
       "        clearInterval(timer);\n",
       "      }\n",
       "      attempts++;\n",
       "      if (attempts > 100) {\n",
       "        console.log(\"Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing\");\n",
       "        clearInterval(timer);\n",
       "      }\n",
       "    }, 10, root)\n",
       "  }\n",
       "})(window);"
      ],
      "application/vnd.bokehjs_exec.v0+json": ""
     },
     "metadata": {
      "application/vnd.bokehjs_exec.v0+json": {
       "id": "1471"
      }
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "from scipy import optimize as sopt\n",
    "\n",
    "data['shunts'] = []\n",
    "\n",
    "V_ref = 1.0\n",
    "p_gen = 2.0e3\n",
    "q_gen = 0\n",
    "\n",
    "data['grid_feeders'][0]['kW'] = p_gen\n",
    "data['grid_feeders'][1]['kW'] = p_gen\n",
    "data['grid_feeders'][2]['kW'] = p_gen\n",
    "\n",
    "grid_1 = grid()\n",
    "grid_1.read(data)  # Load data\n",
    "grid_1.pf() \n",
    "\n",
    "def residual(x):\n",
    "\n",
    "    q_gen = x\n",
    "    data['grid_feeders'][0]['kvar'] = q_gen\n",
    "    data['grid_feeders'][1]['kvar'] = q_gen\n",
    "    data['grid_feeders'][2]['kvar'] = q_gen\n",
    "    grid_1.read(data)  # Load data\n",
    "    grid_1.pf()  # solve power flow    \n",
    "\n",
    "    V = abs(grid_1.res['POI'].v_ag)/66.0e3*np.sqrt(3)\n",
    "\n",
    "    return V_ref - V\n",
    "\n",
    "\n",
    "res = sopt.bisect(residual,-3000.0,3000.0)\n",
    "res\n",
    "\n",
    "p=plot_results(grid_1)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Optimization with reactive powers (without STATCOM)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "     fun: 192203.64692081884\n",
      "     jac: array([0.875, 0.875, 1.375])\n",
      " message: 'Optimization terminated successfully.'\n",
      "    nfev: 61\n",
      "     nit: 8\n",
      "    njev: 8\n",
      "  status: 0\n",
      " success: True\n",
      "       x: array([496.46556547, 496.46556547, 466.3287252 ])\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "\n",
       "\n",
       "\n",
       "\n",
       "\n",
       "\n",
       "  <div class=\"bk-root\" id=\"3568236d-7830-4b56-9b5c-6b87be438cf1\"></div>\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/javascript": [
       "(function(root) {\n",
       "  function embed_document(root) {\n",
       "    \n",
       "  var docs_json = {\"b00e84b1-33c6-483f-893f-7fcc8a8df835\":{\"roots\":{\"references\":[{\"attributes\":{\"below\":[{\"id\":\"1661\",\"type\":\"LinearAxis\"}],\"left\":[{\"id\":\"1666\",\"type\":\"LinearAxis\"}],\"plot_height\":400,\"renderers\":[{\"id\":\"1661\",\"type\":\"LinearAxis\"},{\"id\":\"1665\",\"type\":\"Grid\"},{\"id\":\"1666\",\"type\":\"LinearAxis\"},{\"id\":\"1670\",\"type\":\"Grid\"},{\"id\":\"1679\",\"type\":\"BoxAnnotation\"},{\"id\":\"1690\",\"type\":\"GlyphRenderer\"},{\"id\":\"1696\",\"type\":\"GlyphRenderer\"},{\"id\":\"1702\",\"type\":\"GlyphRenderer\"}],\"title\":{\"id\":\"1650\",\"type\":\"Title\"},\"toolbar\":{\"id\":\"1677\",\"type\":\"Toolbar\"},\"x_range\":{\"id\":\"1653\",\"type\":\"DataRange1d\"},\"x_scale\":{\"id\":\"1657\",\"type\":\"LinearScale\"},\"y_range\":{\"id\":\"1655\",\"type\":\"DataRange1d\"},\"y_scale\":{\"id\":\"1659\",\"type\":\"LinearScale\"}},\"id\":\"1651\",\"subtype\":\"Figure\",\"type\":\"Plot\"},{\"attributes\":{\"fill_alpha\":{\"value\":0.1},\"fill_color\":{\"value\":\"#1f77b4\"},\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"size\":{\"units\":\"screen\",\"value\":15},\"x\":{\"field\":\"x\"},\"y\":{\"field\":\"y\"}},\"id\":\"1701\",\"type\":\"Circle\"},{\"attributes\":{\"data_source\":{\"id\":\"1698\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"1700\",\"type\":\"Circle\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"1701\",\"type\":\"Circle\"},\"selection_glyph\":null,\"view\":{\"id\":\"1703\",\"type\":\"CDSView\"}},\"id\":\"1702\",\"type\":\"GlyphRenderer\"},{\"attributes\":{},\"id\":\"1675\",\"type\":\"ResetTool\"},{\"attributes\":{},\"id\":\"1657\",\"type\":\"LinearScale\"},{\"attributes\":{\"fill_alpha\":{\"value\":0.5},\"fill_color\":{\"value\":\"navy\"},\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"navy\"},\"size\":{\"units\":\"screen\",\"value\":15},\"x\":{\"field\":\"x\"},\"y\":{\"field\":\"y\"}},\"id\":\"1700\",\"type\":\"Circle\"},{\"attributes\":{\"source\":{\"id\":\"1698\",\"type\":\"ColumnDataSource\"}},\"id\":\"1703\",\"type\":\"CDSView\"},{\"attributes\":{},\"id\":\"1763\",\"type\":\"Selection\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"1690\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            transformer id = @trafo_id  \\n            <table border=\\\"5\\\">\\n                <tr >\\n                    <td>I<sub>1a</sub> =  @i_1a_m &ang; @deg_1a </td>\\n                    <td>I<sub>2a</sub> =  @i_2a_m &ang; @deg_2a </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>1b</sub> =  @i_1b_m &ang; @deg_1b </td>\\n                    <td >I<sub>2b</sub> =  @i_2b_m &ang; @deg_2b </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>1c</sub> =  @i_1c_m &ang; @deg_1c </td>\\n                    <td >I<sub>2c</sub> =  @i_2c_m &ang; @deg_2c </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>1n</sub> =  @i_1n_m &ang; @deg_1n </td>\\n                    <td >I<sub>2n</sub> =  @i_2n_m &ang; @deg_2n </td>\\n                </tr>\\n            </table>            \\n            </div>\\n            \"},\"id\":\"1704\",\"type\":\"HoverTool\"},{\"attributes\":{\"dimension\":1,\"plot\":{\"id\":\"1651\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1667\",\"type\":\"BasicTicker\"}},\"id\":\"1670\",\"type\":\"Grid\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"1696\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            line id = @line_id \\n            <table border=\\\"5\\\">\\n                <tr >\\n                    <td>I<sub>ja</sub> =  @i_j_a_m &ang; @deg_j_a </td>\\n                    <td>I<sub>ka</sub> =  @i_k_a_m &ang; @deg_k_a </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>jb</sub> =  @i_j_b_m &ang; @deg_j_b </td>\\n                    <td >I<sub>kb</sub> =  @i_k_b_m &ang; @deg_k_b </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>jc</sub> =  @i_j_c_m &ang; @deg_j_c </td>\\n                    <td >I<sub>kc</sub> =  @i_k_c_m &ang; @deg_k_c </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>jn</sub> =  @i_j_n_m &ang; @deg_j_n </td>\\n                    <td >I<sub>kn</sub> =  @i_k_n_m &ang; @deg_k_n </td>\\n                </tr>\\n            </table>            \\n            </div>\\n            \"},\"id\":\"1706\",\"type\":\"HoverTool\"},{\"attributes\":{},\"id\":\"1767\",\"type\":\"Selection\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"1702\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            bus_id = @bus_id &nbsp &nbsp |  u<sub>avg</sub>= @u_avg_pu pu |  u<sub>unb</sub>= @v_unb %\\n            <table border=\\\"1\\\">\\n                <tr>\\n                <td>v<sub>an</sub> =  @v_an  &ang; @deg_an V </td> <td> S<sub>a</sub> = @p_a + j@q_a kVA</td>\\n                </tr>\\n                      <tr>\\n                      <td> </td> <td>v<sub>ab</sub>= @v_ab V</td>\\n                      </tr>\\n                <tr>\\n                <td>v<sub>bn</sub> = @v_bn &ang; @deg_bn V </td><td> S<sub>b</sub> = @p_b + j@q_b kVA</td>\\n                </tr>\\n                      <tr>\\n                      <td> </td><td>v<sub>bc</sub>= @v_bc V</td>\\n                      </tr>\\n                <tr>\\n                <td>v<sub>cn</sub>  = @v_cn &ang; @deg_cn V </td>  <td>S<sub>c</sub> = @p_c + j@q_c kVA </td>\\n                </tr> \\n                    <tr>\\n                     <td> </td> <td>v<sub>ca</sub>= @v_ca V</td>\\n                    </tr>\\n               <tr>\\n                <td>v<sub>ng</sub>    = @v_ng &ang; @deg_ng V</td>  <td>S<sub>abc</sub> = @p_abc + j@q_abc kVA </td>\\n              </tr>\\n            </table>\\n            </div>\\n            \"},\"id\":\"1708\",\"type\":\"HoverTool\"},{\"attributes\":{\"callback\":null,\"data\":{\"deg_1a\":[-0.08914250838870358,-179.8194665367127,-179.83408478233954,-179.29346563222234],\"deg_1b\":[119.9108577576062,-59.81946625465535,-59.83408450668925,-59.29346535199303],\"deg_1c\":[-120.0891439309823,60.18053204687014,60.16591380017131,60.706532959440075],\"deg_1n\":[-146.30993247402023,-75.96375653207353,135.0,135.0],\"deg_2a\":[-150.08914354544936,30.180532152798552,30.16591391078211,30.70653306972446],\"deg_2b\":[-30.08914185686088,150.1805346458966,150.16591639490898,150.70653554224282],\"deg_2c\":[89.91085672054552,-89.81946754319314,-89.83408579454861,-89.29346663674269],\"deg_2n\":[90.0,-118.42983427717346,-118.62665265521854,-118.44429150553684],\"i_1a_m\":[248.86699311033277,82.87085969291647,82.90911020798222,82.90879691883237],\"i_1b_m\":[248.86698530826988,82.87085709178986,82.90910760921619,82.90879433154193],\"i_1c_m\":[248.86698820872928,82.87085803905009,82.90910856316243,82.90879527401337],\"i_1n_m\":[4.0990372275064023e-13,2.3437142008433856e-13,1.6077746776921858e-13,1.6077746776921858e-13],\"i_2a_m\":[75.41424013432868,2402.053878613092,2403.1625893551422,2403.153508431401],\"i_2b_m\":[75.4142392554017,2402.0538693272542,2403.1625799378335,2403.1534994530725],\"i_2c_m\":[75.41423777006729,2402.0538411540297,2403.162551876899,2403.15347108329],\"i_2n_m\":[1.7053025658242404e-13,6.572626423377997e-05,6.556975742240821e-05,6.521162483473028e-05],\"trafo_id\":[\"POImv-POI\",\"W1mv-W1lv\",\"W2mv-W2lv\",\"W3mv-W3lv\"],\"x_s\":[[0.0,100.0],[-1500.0,-1500.0],[-1000.0,-1000.0],[-500.0,-500.0]],\"y_s\":[[0.0,0.0],[180.0,200.0],[180.0,200.0],[180.0,200.0]]},\"selected\":{\"id\":\"1763\",\"type\":\"Selection\"},\"selection_policy\":{\"id\":\"1764\",\"type\":\"UnionRenderers\"}},\"id\":\"1686\",\"type\":\"ColumnDataSource\"},{\"attributes\":{},\"id\":\"1659\",\"type\":\"LinearScale\"},{\"attributes\":{\"plot\":{\"id\":\"1651\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1662\",\"type\":\"BasicTicker\"}},\"id\":\"1665\",\"type\":\"Grid\"},{\"attributes\":{},\"id\":\"1760\",\"type\":\"BasicTickFormatter\"},{\"attributes\":{\"callback\":null},\"id\":\"1655\",\"type\":\"DataRange1d\"},{\"attributes\":{},\"id\":\"1762\",\"type\":\"BasicTickFormatter\"},{\"attributes\":{},\"id\":\"1768\",\"type\":\"UnionRenderers\"},{\"attributes\":{\"data_source\":{\"id\":\"1692\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"1694\",\"type\":\"MultiLine\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"1695\",\"type\":\"MultiLine\"},\"selection_glyph\":null,\"view\":{\"id\":\"1697\",\"type\":\"CDSView\"}},\"id\":\"1696\",\"type\":\"GlyphRenderer\"},{\"attributes\":{},\"id\":\"1667\",\"type\":\"BasicTicker\"},{\"attributes\":{\"formatter\":{\"id\":\"1762\",\"type\":\"BasicTickFormatter\"},\"plot\":{\"id\":\"1651\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1667\",\"type\":\"BasicTicker\"}},\"id\":\"1666\",\"type\":\"LinearAxis\"},{\"attributes\":{\"callback\":null},\"id\":\"1653\",\"type\":\"DataRange1d\"},{\"attributes\":{\"callback\":null,\"data\":{\"deg_j_a\":[0.18053346333710035,-0.04692607232667749,0.057549486614593554,29.910856454550892],\"deg_j_b\":[120.18053374535118,119.95307419982849,120.05754975704434,149.9108581431394],\"deg_j_c\":[-119.81946795309678,-120.04692749351887,-119.9424519331139,-90.08914327945412],\"deg_j_n\":[95.88325027219454,95.79696861907001,82.16073666819457,47.39906655118344],\"deg_k_a\":[-0.2596948790588902,-0.26675160613967297,-0.08885902029336666,29.910856454550892],\"deg_k_b\":[119.74030538956066,119.7332486593245,119.91114124568523,149.9108581431394],\"deg_k_c\":[-120.25969630395545,-120.26675303152643,-120.0888604428222,-90.08914327945412],\"deg_k_n\":[95.52646639937753,95.61303642204899,81.61938677707235,47.39906655118344],\"i_j_a_m\":[82.87085969284975,165.84532073567038,248.81359027860017,75.41424013432862],\"i_j_b_m\":[82.87085709175584,165.84531553080296,248.81358248147023,75.41423925540157],\"i_j_c_m\":[82.87085803902437,165.84531745095217,248.81358536297495,75.41423777006676],\"i_j_n_m\":[3.66009936274996e-11,7.31621451047007e-11,2.5734774985193973e-11,3.282014745864383e-13],\"i_k_a_m\":[82.93735444413537,165.9127695332373,248.878889854053,75.41424013432862],\"i_k_b_m\":[82.93735183800351,165.91276432341394,248.87888205199357,75.41423925540157],\"i_k_c_m\":[82.93735280429901,165.91276626254322,248.87888495244036,75.41423777006676],\"i_k_n_m\":[3.652112316890518e-11,7.308156802994212e-11,2.5740718625400617e-11,3.282014745864383e-13],\"line_id\":[\"W1mv-W2mv\",\"W2mv-W3mv\",\"W3mv-POImv\",\"POI-GRID\"],\"x_s\":[[-1500.0,-1000.0],[-1000.0,-500.0],[-500.0,0.0],[100.0,500.0]],\"y_s\":[[180.0,180.0],[180.0,180.0],[180.0,0.0],[0.0,0.0]]},\"selected\":{\"id\":\"1765\",\"type\":\"Selection\"},\"selection_policy\":{\"id\":\"1766\",\"type\":\"UnionRenderers\"}},\"id\":\"1692\",\"type\":\"ColumnDataSource\"},{\"attributes\":{\"source\":{\"id\":\"1686\",\"type\":\"ColumnDataSource\"}},\"id\":\"1691\",\"type\":\"CDSView\"},{\"attributes\":{},\"id\":\"1672\",\"type\":\"WheelZoomTool\"},{\"attributes\":{\"formatter\":{\"id\":\"1760\",\"type\":\"BasicTickFormatter\"},\"plot\":{\"id\":\"1651\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1662\",\"type\":\"BasicTicker\"}},\"id\":\"1661\",\"type\":\"LinearAxis\"},{\"attributes\":{\"active_drag\":\"auto\",\"active_inspect\":\"auto\",\"active_multi\":null,\"active_scroll\":\"auto\",\"active_tap\":\"auto\",\"tools\":[{\"id\":\"1671\",\"type\":\"PanTool\"},{\"id\":\"1672\",\"type\":\"WheelZoomTool\"},{\"id\":\"1673\",\"type\":\"BoxZoomTool\"},{\"id\":\"1674\",\"type\":\"SaveTool\"},{\"id\":\"1675\",\"type\":\"ResetTool\"},{\"id\":\"1676\",\"type\":\"HelpTool\"},{\"id\":\"1704\",\"type\":\"HoverTool\"},{\"id\":\"1706\",\"type\":\"HoverTool\"},{\"id\":\"1708\",\"type\":\"HoverTool\"}]},\"id\":\"1677\",\"type\":\"Toolbar\"},{\"attributes\":{\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1695\",\"type\":\"MultiLine\"},{\"attributes\":{},\"id\":\"1671\",\"type\":\"PanTool\"},{\"attributes\":{},\"id\":\"1764\",\"type\":\"UnionRenderers\"},{\"attributes\":{},\"id\":\"1662\",\"type\":\"BasicTicker\"},{\"attributes\":{},\"id\":\"1676\",\"type\":\"HelpTool\"},{\"attributes\":{\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1689\",\"type\":\"MultiLine\"},{\"attributes\":{\"callback\":null,\"data\":{\"bus_id\":[\"W1lv\",\"W2lv\",\"W3lv\",\"W1mv\",\"W2mv\",\"W3mv\",\"POImv\",\"POI\",\"GRID\"],\"deg_an\":[\"39.58\",\"39.56\",\"39.54\",\"5.93\",\"5.91\",\"5.87\",\"5.82\",\"32.02\",\"30.00\"],\"deg_bn\":[\"159.58\",\"159.56\",\"159.54\",\"125.93\",\"125.91\",\"125.87\",\"125.82\",\"152.02\",\"150.00\"],\"deg_cn\":[\"-80.42\",\"-80.44\",\"-80.46\",\"-114.07\",\"-114.09\",\"-114.13\",\"-114.18\",\"-87.98\",\"-90.00\"],\"deg_ng\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\"],\"p_a\":[\"1000.00\",\"1000.00\",\"1000.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"-2873.66\"],\"p_abc\":[\"3000.00\",\"3000.00\",\"3000.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"-8620.97\"],\"p_b\":[\"1000.00\",\"1000.00\",\"1000.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"-2873.66\"],\"p_c\":[\"1000.00\",\"1000.00\",\"1000.00\",\"-0.00\",\"-0.00\",\"-0.00\",\"-0.00\",\"0.00\",\"-2873.66\"],\"q_a\":[\"165.49\",\"165.49\",\"155.44\",\"0.00\",\"0.00\",\"-0.00\",\"0.00\",\"0.00\",\"-4.47\"],\"q_abc\":[\"496.47\",\"496.47\",\"466.33\",\"0.00\",\"0.00\",\"-0.00\",\"0.00\",\"0.00\",\"-13.41\"],\"q_b\":[\"165.49\",\"165.49\",\"155.44\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"-4.47\"],\"q_c\":[\"165.49\",\"165.49\",\"155.44\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"-0.00\",\"-4.47\"],\"s_color\":[\"red\",\"red\",\"red\",\"blue\",\"blue\",\"red\",\"blue\",\"blue\",\"green\"],\"s_radio\":[17.43788940145094,17.437889422856735,17.424193252432,1,1,1,1,1,20],\"u_avg_pu\":[\"1.059\",\"1.059\",\"1.057\",\"1.039\",\"1.038\",\"1.037\",\"1.036\",\"1.022\",\"1.000\"],\"v_ab\":[730.8772919109404,730.5400999183587,729.3957364400056,20775.398805412562,20765.475796891853,20745.6006175936,20715.848419632708,67475.84978531091,65999.79602241208],\"v_an\":[\"421.97\",\"421.78\",\"421.12\",\"11994.68\",\"11988.95\",\"11977.48\",\"11960.30\",\"38957.20\",\"38105.00\"],\"v_an_pu\":[\"1.0592\",\"1.0588\",\"1.0571\",\"1.0388\",\"1.0383\",\"1.0373\",\"1.0358\",\"1.0224\",\"1.0000\"],\"v_bc\":[730.8772897814242,730.5400978069558,729.3957343653508,20775.398839321377,20765.47583085519,20745.600651664103,20715.84845385947,67475.84972693215,65999.79602241208],\"v_bn\":[\"421.97\",\"421.78\",\"421.12\",\"11994.68\",\"11988.95\",\"11977.48\",\"11960.30\",\"38957.20\",\"38105.00\"],\"v_bn_pu\":[\"1.0592\",\"1.0588\",\"1.0571\",\"1.0388\",\"1.0383\",\"1.0373\",\"1.0358\",\"1.0224\",\"1.0000\"],\"v_ca\":[730.8772937575714,730.540101770658,729.3957383023845,20775.398876580726,20765.47586775236,20745.60068783806,20715.848488951724,67475.84981326839,65999.79602241208],\"v_cn\":[\"421.97\",\"421.78\",\"421.12\",\"11994.68\",\"11988.95\",\"11977.48\",\"11960.30\",\"38957.20\",\"38105.00\"],\"v_cn_pu\":[\"1.0592\",\"1.0588\",\"1.0571\",\"1.0388\",\"1.0383\",\"1.0373\",\"1.0358\",\"1.0224\",\"1.0000\"],\"v_ng\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\"],\"v_unb\":[\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\"],\"x\":[-1500.0,-1000.0,-500.0,-1500.0,-1000.0,-500.0,0.0,100.0,500.0],\"y\":[200.0,200.0,200.0,180.0,180.0,180.0,0.0,0.0,0.0]},\"selected\":{\"id\":\"1767\",\"type\":\"Selection\"},\"selection_policy\":{\"id\":\"1768\",\"type\":\"UnionRenderers\"}},\"id\":\"1698\",\"type\":\"ColumnDataSource\"},{\"attributes\":{},\"id\":\"1766\",\"type\":\"UnionRenderers\"},{\"attributes\":{\"plot\":null,\"text\":\"Results\"},\"id\":\"1650\",\"type\":\"Title\"},{\"attributes\":{\"bottom_units\":\"screen\",\"fill_alpha\":{\"value\":0.5},\"fill_color\":{\"value\":\"lightgrey\"},\"left_units\":\"screen\",\"level\":\"overlay\",\"line_alpha\":{\"value\":1.0},\"line_color\":{\"value\":\"black\"},\"line_dash\":[4,4],\"line_width\":{\"value\":2},\"plot\":null,\"render_mode\":\"css\",\"right_units\":\"screen\",\"top_units\":\"screen\"},\"id\":\"1679\",\"type\":\"BoxAnnotation\"},{\"attributes\":{\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"green\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1688\",\"type\":\"MultiLine\"},{\"attributes\":{\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"red\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1694\",\"type\":\"MultiLine\"},{\"attributes\":{},\"id\":\"1765\",\"type\":\"Selection\"},{\"attributes\":{\"overlay\":{\"id\":\"1679\",\"type\":\"BoxAnnotation\"}},\"id\":\"1673\",\"type\":\"BoxZoomTool\"},{\"attributes\":{\"data_source\":{\"id\":\"1686\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"1688\",\"type\":\"MultiLine\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"1689\",\"type\":\"MultiLine\"},\"selection_glyph\":null,\"view\":{\"id\":\"1691\",\"type\":\"CDSView\"}},\"id\":\"1690\",\"type\":\"GlyphRenderer\"},{\"attributes\":{},\"id\":\"1674\",\"type\":\"SaveTool\"},{\"attributes\":{\"source\":{\"id\":\"1692\",\"type\":\"ColumnDataSource\"}},\"id\":\"1697\",\"type\":\"CDSView\"}],\"root_ids\":[\"1651\"]},\"title\":\"Bokeh Application\",\"version\":\"1.0.1\"}};\n",
       "  var render_items = [{\"docid\":\"b00e84b1-33c6-483f-893f-7fcc8a8df835\",\"roots\":{\"1651\":\"3568236d-7830-4b56-9b5c-6b87be438cf1\"}}];\n",
       "  root.Bokeh.embed.embed_items_notebook(docs_json, render_items);\n",
       "\n",
       "  }\n",
       "  if (root.Bokeh !== undefined) {\n",
       "    embed_document(root);\n",
       "  } else {\n",
       "    var attempts = 0;\n",
       "    var timer = setInterval(function(root) {\n",
       "      if (root.Bokeh !== undefined) {\n",
       "        embed_document(root);\n",
       "        clearInterval(timer);\n",
       "      }\n",
       "      attempts++;\n",
       "      if (attempts > 100) {\n",
       "        console.log(\"Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing\");\n",
       "        clearInterval(timer);\n",
       "      }\n",
       "    }, 10, root)\n",
       "  }\n",
       "})(window);"
      ],
      "application/vnd.bokehjs_exec.v0+json": ""
     },
     "metadata": {
      "application/vnd.bokehjs_exec.v0+json": {
       "id": "1651"
      }
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "V_ref = 1.0\n",
    "p_gen = 3.0e3\n",
    "q_gen = 0\n",
    "\n",
    "data['grid_feeders'][0]['kW'] = p_gen\n",
    "data['grid_feeders'][1]['kW'] = p_gen\n",
    "data['grid_feeders'][2]['kW'] = p_gen\n",
    "\n",
    "grid_1 = grid()\n",
    "grid_1.read(data)  # Load data\n",
    "grid_1.pf() \n",
    "\n",
    "\n",
    "def obj(x):\n",
    "\n",
    "    data['grid_feeders'][0]['kvar'] = x[0]\n",
    "    data['grid_feeders'][1]['kvar'] = x[1]\n",
    "    data['grid_feeders'][2]['kvar'] = x[2]\n",
    "    grid_1.read(data)  # Load data\n",
    "    grid_1.pf()  # solve power flow    \n",
    "    mon = grid_1.monitor(bus_from='POI', bus_to='GRID')\n",
    "\n",
    "    P_loss = p_gen*3*1000 - mon.P \n",
    "\n",
    "    return P_loss\n",
    "\n",
    "\n",
    "res = sopt.minimize(obj,[0,0,0], method='SLSQP')\n",
    "print(res)\n",
    "\n",
    "p=plot_results(grid_1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "POI active power = 8.808 MW\n",
      "POI reactive power = 0.32 Mvar\n"
     ]
    }
   ],
   "source": [
    "mon = grid_1.monitor(bus_from='POI', bus_to='GRID')\n",
    "print('POI active power = {:0.3f} MW'.format(mon.P/1e6))\n",
    "print('POI reactive power = {:0.2f} Mvar'.format(mon.Q/1e6))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Optimization with reactive powers (with STATCOM)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "     fun: 192924.1092131082\n",
      "   maxcv: 0.0\n",
      " message: 'Optimization terminated successfully.'\n",
      "    nfev: 644\n",
      "  status: 1\n",
      " success: True\n",
      "       x: array([201.34719703, 200.97303112, 200.48882721, 286.99544409])\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "\n",
       "\n",
       "\n",
       "\n",
       "\n",
       "\n",
       "  <div class=\"bk-root\" id=\"c6b3ba73-347c-4b4e-8ae3-151b8cfa9ab1\"></div>\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/javascript": [
       "(function(root) {\n",
       "  function embed_document(root) {\n",
       "    \n",
       "  var docs_json = {\"07238305-e8e4-4f42-beb2-9db8c8026a89\":{\"roots\":{\"references\":[{\"attributes\":{\"below\":[{\"id\":\"1853\",\"type\":\"LinearAxis\"}],\"left\":[{\"id\":\"1858\",\"type\":\"LinearAxis\"}],\"plot_height\":400,\"renderers\":[{\"id\":\"1853\",\"type\":\"LinearAxis\"},{\"id\":\"1857\",\"type\":\"Grid\"},{\"id\":\"1858\",\"type\":\"LinearAxis\"},{\"id\":\"1862\",\"type\":\"Grid\"},{\"id\":\"1871\",\"type\":\"BoxAnnotation\"},{\"id\":\"1882\",\"type\":\"GlyphRenderer\"},{\"id\":\"1888\",\"type\":\"GlyphRenderer\"},{\"id\":\"1894\",\"type\":\"GlyphRenderer\"}],\"title\":{\"id\":\"1842\",\"type\":\"Title\"},\"toolbar\":{\"id\":\"1869\",\"type\":\"Toolbar\"},\"x_range\":{\"id\":\"1845\",\"type\":\"DataRange1d\"},\"x_scale\":{\"id\":\"1849\",\"type\":\"LinearScale\"},\"y_range\":{\"id\":\"1847\",\"type\":\"DataRange1d\"},\"y_scale\":{\"id\":\"1851\",\"type\":\"LinearScale\"}},\"id\":\"1843\",\"subtype\":\"Figure\",\"type\":\"Plot\"},{\"attributes\":{},\"id\":\"1967\",\"type\":\"Selection\"},{\"attributes\":{\"active_drag\":\"auto\",\"active_inspect\":\"auto\",\"active_multi\":null,\"active_scroll\":\"auto\",\"active_tap\":\"auto\",\"tools\":[{\"id\":\"1863\",\"type\":\"PanTool\"},{\"id\":\"1864\",\"type\":\"WheelZoomTool\"},{\"id\":\"1865\",\"type\":\"BoxZoomTool\"},{\"id\":\"1866\",\"type\":\"SaveTool\"},{\"id\":\"1867\",\"type\":\"ResetTool\"},{\"id\":\"1868\",\"type\":\"HelpTool\"},{\"id\":\"1896\",\"type\":\"HoverTool\"},{\"id\":\"1898\",\"type\":\"HoverTool\"},{\"id\":\"1900\",\"type\":\"HoverTool\"}]},\"id\":\"1869\",\"type\":\"Toolbar\"},{\"attributes\":{\"data_source\":{\"id\":\"1884\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"1886\",\"type\":\"MultiLine\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"1887\",\"type\":\"MultiLine\"},\"selection_glyph\":null,\"view\":{\"id\":\"1889\",\"type\":\"CDSView\"}},\"id\":\"1888\",\"type\":\"GlyphRenderer\"},{\"attributes\":{\"bottom_units\":\"screen\",\"fill_alpha\":{\"value\":0.5},\"fill_color\":{\"value\":\"lightgrey\"},\"left_units\":\"screen\",\"level\":\"overlay\",\"line_alpha\":{\"value\":1.0},\"line_color\":{\"value\":\"black\"},\"line_dash\":[4,4],\"line_width\":{\"value\":2},\"plot\":null,\"render_mode\":\"css\",\"right_units\":\"screen\",\"top_units\":\"screen\"},\"id\":\"1871\",\"type\":\"BoxAnnotation\"},{\"attributes\":{},\"id\":\"1854\",\"type\":\"BasicTicker\"},{\"attributes\":{\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1881\",\"type\":\"MultiLine\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"1894\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            bus_id = @bus_id &nbsp &nbsp |  u<sub>avg</sub>= @u_avg_pu pu |  u<sub>unb</sub>= @v_unb %\\n            <table border=\\\"1\\\">\\n                <tr>\\n                <td>v<sub>an</sub> =  @v_an  &ang; @deg_an V </td> <td> S<sub>a</sub> = @p_a + j@q_a kVA</td>\\n                </tr>\\n                      <tr>\\n                      <td> </td> <td>v<sub>ab</sub>= @v_ab V</td>\\n                      </tr>\\n                <tr>\\n                <td>v<sub>bn</sub> = @v_bn &ang; @deg_bn V </td><td> S<sub>b</sub> = @p_b + j@q_b kVA</td>\\n                </tr>\\n                      <tr>\\n                      <td> </td><td>v<sub>bc</sub>= @v_bc V</td>\\n                      </tr>\\n                <tr>\\n                <td>v<sub>cn</sub>  = @v_cn &ang; @deg_cn V </td>  <td>S<sub>c</sub> = @p_c + j@q_c kVA </td>\\n                </tr> \\n                    <tr>\\n                     <td> </td> <td>v<sub>ca</sub>= @v_ca V</td>\\n                    </tr>\\n               <tr>\\n                <td>v<sub>ng</sub>    = @v_ng &ang; @deg_ng V</td>  <td>S<sub>abc</sub> = @p_abc + j@q_abc kVA </td>\\n              </tr>\\n            </table>\\n            </div>\\n            \"},\"id\":\"1900\",\"type\":\"HoverTool\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"1882\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            transformer id = @trafo_id  \\n            <table border=\\\"5\\\">\\n                <tr >\\n                    <td>I<sub>1a</sub> =  @i_1a_m &ang; @deg_1a </td>\\n                    <td>I<sub>2a</sub> =  @i_2a_m &ang; @deg_2a </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>1b</sub> =  @i_1b_m &ang; @deg_1b </td>\\n                    <td >I<sub>2b</sub> =  @i_2b_m &ang; @deg_2b </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>1c</sub> =  @i_1c_m &ang; @deg_1c </td>\\n                    <td >I<sub>2c</sub> =  @i_2c_m &ang; @deg_2c </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>1n</sub> =  @i_1n_m &ang; @deg_1n </td>\\n                    <td >I<sub>2n</sub> =  @i_2n_m &ang; @deg_2n </td>\\n                </tr>\\n            </table>            \\n            </div>\\n            \"},\"id\":\"1896\",\"type\":\"HoverTool\"},{\"attributes\":{\"plot\":null,\"text\":\"Results\"},\"id\":\"1842\",\"type\":\"Title\"},{\"attributes\":{},\"id\":\"1970\",\"type\":\"UnionRenderers\"},{\"attributes\":{\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"red\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1886\",\"type\":\"MultiLine\"},{\"attributes\":{},\"id\":\"1851\",\"type\":\"LinearScale\"},{\"attributes\":{\"source\":{\"id\":\"1884\",\"type\":\"ColumnDataSource\"}},\"id\":\"1889\",\"type\":\"CDSView\"},{\"attributes\":{\"callback\":null,\"renderers\":[{\"id\":\"1888\",\"type\":\"GlyphRenderer\"}],\"tooltips\":\"\\n            <div>\\n            line id = @line_id \\n            <table border=\\\"5\\\">\\n                <tr >\\n                    <td>I<sub>ja</sub> =  @i_j_a_m &ang; @deg_j_a </td>\\n                    <td>I<sub>ka</sub> =  @i_k_a_m &ang; @deg_k_a </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>jb</sub> =  @i_j_b_m &ang; @deg_j_b </td>\\n                    <td >I<sub>kb</sub> =  @i_k_b_m &ang; @deg_k_b </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>jc</sub> =  @i_j_c_m &ang; @deg_j_c </td>\\n                    <td >I<sub>kc</sub> =  @i_k_c_m &ang; @deg_k_c </td>\\n                </tr>\\n                <tr>\\n                    <td >I<sub>jn</sub> =  @i_j_n_m &ang; @deg_j_n </td>\\n                    <td >I<sub>kn</sub> =  @i_k_n_m &ang; @deg_k_n </td>\\n                </tr>\\n            </table>            \\n            </div>\\n            \"},\"id\":\"1898\",\"type\":\"HoverTool\"},{\"attributes\":{\"plot\":{\"id\":\"1843\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1854\",\"type\":\"BasicTicker\"}},\"id\":\"1857\",\"type\":\"Grid\"},{\"attributes\":{},\"id\":\"1964\",\"type\":\"BasicTickFormatter\"},{\"attributes\":{\"source\":{\"id\":\"1878\",\"type\":\"ColumnDataSource\"}},\"id\":\"1883\",\"type\":\"CDSView\"},{\"attributes\":{\"callback\":null},\"id\":\"1845\",\"type\":\"DataRange1d\"},{\"attributes\":{\"formatter\":{\"id\":\"1966\",\"type\":\"BasicTickFormatter\"},\"plot\":{\"id\":\"1843\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1859\",\"type\":\"BasicTicker\"}},\"id\":\"1858\",\"type\":\"LinearAxis\"},{\"attributes\":{},\"id\":\"1971\",\"type\":\"Selection\"},{\"attributes\":{},\"id\":\"1859\",\"type\":\"BasicTicker\"},{\"attributes\":{\"formatter\":{\"id\":\"1964\",\"type\":\"BasicTickFormatter\"},\"plot\":{\"id\":\"1843\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1854\",\"type\":\"BasicTicker\"}},\"id\":\"1853\",\"type\":\"LinearAxis\"},{\"attributes\":{\"source\":{\"id\":\"1890\",\"type\":\"ColumnDataSource\"}},\"id\":\"1895\",\"type\":\"CDSView\"},{\"attributes\":{\"dimension\":1,\"plot\":{\"id\":\"1843\",\"subtype\":\"Figure\",\"type\":\"Plot\"},\"ticker\":{\"id\":\"1859\",\"type\":\"BasicTicker\"}},\"id\":\"1862\",\"type\":\"Grid\"},{\"attributes\":{\"fill_alpha\":{\"value\":0.1},\"fill_color\":{\"value\":\"#1f77b4\"},\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"size\":{\"units\":\"screen\",\"value\":15},\"x\":{\"field\":\"x\"},\"y\":{\"field\":\"y\"}},\"id\":\"1893\",\"type\":\"Circle\"},{\"attributes\":{\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"green\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1880\",\"type\":\"MultiLine\"},{\"attributes\":{\"fill_alpha\":{\"value\":0.5},\"fill_color\":{\"value\":\"navy\"},\"line_alpha\":{\"value\":0.5},\"line_color\":{\"value\":\"navy\"},\"size\":{\"units\":\"screen\",\"value\":15},\"x\":{\"field\":\"x\"},\"y\":{\"field\":\"y\"}},\"id\":\"1892\",\"type\":\"Circle\"},{\"attributes\":{\"data_source\":{\"id\":\"1878\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"1880\",\"type\":\"MultiLine\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"1881\",\"type\":\"MultiLine\"},\"selection_glyph\":null,\"view\":{\"id\":\"1883\",\"type\":\"CDSView\"}},\"id\":\"1882\",\"type\":\"GlyphRenderer\"},{\"attributes\":{\"data_source\":{\"id\":\"1890\",\"type\":\"ColumnDataSource\"},\"glyph\":{\"id\":\"1892\",\"type\":\"Circle\"},\"hover_glyph\":null,\"muted_glyph\":null,\"nonselection_glyph\":{\"id\":\"1893\",\"type\":\"Circle\"},\"selection_glyph\":null,\"view\":{\"id\":\"1895\",\"type\":\"CDSView\"}},\"id\":\"1894\",\"type\":\"GlyphRenderer\"},{\"attributes\":{},\"id\":\"1972\",\"type\":\"UnionRenderers\"},{\"attributes\":{\"callback\":null},\"id\":\"1847\",\"type\":\"DataRange1d\"},{\"attributes\":{\"callback\":null,\"data\":{\"bus_id\":[\"W1lv\",\"W2lv\",\"W3lv\",\"W1mv\",\"W2mv\",\"W3mv\",\"POImv\",\"POI\",\"GRID\"],\"deg_an\":[\"39.88\",\"39.86\",\"39.83\",\"6.10\",\"6.08\",\"6.03\",\"5.97\",\"32.11\",\"30.00\"],\"deg_bn\":[\"159.88\",\"159.86\",\"159.83\",\"126.10\",\"126.08\",\"126.03\",\"125.97\",\"152.11\",\"150.00\"],\"deg_cn\":[\"-80.12\",\"-80.14\",\"-80.17\",\"-113.90\",\"-113.92\",\"-113.97\",\"-114.03\",\"-87.89\",\"-90.00\"],\"deg_ng\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\"],\"p_a\":[\"1000.00\",\"1000.00\",\"1000.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"-2873.17\"],\"p_abc\":[\"3000.00\",\"3000.00\",\"3000.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"-8619.51\"],\"p_b\":[\"1000.00\",\"1000.00\",\"1000.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"-2873.17\"],\"p_c\":[\"1000.00\",\"1000.00\",\"1000.00\",\"-0.00\",\"-0.00\",\"-0.00\",\"0.00\",\"0.00\",\"-2873.17\"],\"q_a\":[\"67.12\",\"66.99\",\"66.83\",\"0.00\",\"0.00\",\"-0.00\",\"95.67\",\"0.00\",\"187.62\"],\"q_abc\":[\"201.35\",\"200.97\",\"200.49\",\"0.00\",\"0.00\",\"-0.00\",\"287.00\",\"0.00\",\"562.87\"],\"q_b\":[\"67.12\",\"66.99\",\"66.83\",\"0.00\",\"0.00\",\"0.00\",\"95.67\",\"0.00\",\"187.62\"],\"q_c\":[\"67.12\",\"66.99\",\"66.83\",\"0.00\",\"0.00\",\"0.00\",\"95.67\",\"-0.00\",\"187.62\"],\"s_color\":[\"red\",\"red\",\"red\",\"blue\",\"blue\",\"red\",\"red\",\"blue\",\"green\"],\"s_radio\":[17.339973042319233,17.339900883682834,17.33980771898311,1,1,1,5.3571941934805105,1,20],\"u_avg_pu\":[\"1.046\",\"1.045\",\"1.044\",\"1.032\",\"1.031\",\"1.030\",\"1.029\",\"1.020\",\"1.000\"],\"v_ab\":[721.4842684540512,721.1624824899358,720.5221924745963,20635.61225438389,20626.37560130501,20607.876198029335,20580.119044505784,67319.79189822184,65999.79602241208],\"v_an\":[\"416.55\",\"416.36\",\"415.99\",\"11913.98\",\"11908.64\",\"11897.96\",\"11881.94\",\"38867.10\",\"38105.00\"],\"v_an_pu\":[\"1.0456\",\"1.0452\",\"1.0442\",\"1.0318\",\"1.0313\",\"1.0304\",\"1.0290\",\"1.0200\",\"1.0000\"],\"v_bc\":[721.4842665270486,721.1624805821984,720.5221906054255,20635.612297684438,20626.37564462661,20607.876241390928,20580.119087922176,67319.7918430841,65999.79602241208],\"v_bn\":[\"416.55\",\"416.36\",\"415.99\",\"11913.98\",\"11908.64\",\"11897.96\",\"11881.94\",\"38867.10\",\"38105.00\"],\"v_bn_pu\":[\"1.0456\",\"1.0452\",\"1.0442\",\"1.0318\",\"1.0313\",\"1.0304\",\"1.0290\",\"1.0200\",\"1.0000\"],\"v_ca\":[721.4842708073403,721.1624848475702,720.5221948408382,20635.6123308873,20626.37567745329,20607.876273466703,20580.11911887539,67319.79193761069,65999.79602241208],\"v_cn\":[\"416.55\",\"416.36\",\"415.99\",\"11913.98\",\"11908.64\",\"11897.96\",\"11881.94\",\"38867.10\",\"38105.00\"],\"v_cn_pu\":[\"1.0456\",\"1.0452\",\"1.0442\",\"1.0318\",\"1.0313\",\"1.0304\",\"1.0290\",\"1.0200\",\"1.0000\"],\"v_ng\":[\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\"],\"v_unb\":[\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\"],\"x\":[-1500.0,-1000.0,-500.0,-1500.0,-1000.0,-500.0,0.0,100.0,500.0],\"y\":[200.0,200.0,200.0,180.0,180.0,180.0,0.0,0.0,0.0]},\"selected\":{\"id\":\"1971\",\"type\":\"Selection\"},\"selection_policy\":{\"id\":\"1972\",\"type\":\"UnionRenderers\"}},\"id\":\"1890\",\"type\":\"ColumnDataSource\"},{\"attributes\":{},\"id\":\"1863\",\"type\":\"PanTool\"},{\"attributes\":{},\"id\":\"1968\",\"type\":\"UnionRenderers\"},{\"attributes\":{\"callback\":null,\"data\":{\"deg_j_a\":[6.040359900791529,5.815733078561241,5.732536011385108,33.736229448736175],\"deg_j_b\":[126.04036020811931,125.8157333754819,125.73253630025278,153.73623123539997],\"deg_j_c\":[-113.95964161847162,-114.18426844618772,-114.26746551579458,-86.26377034171256],\"deg_j_n\":[96.21596478193452,-19.955032278225005,-22.1835435966449,91.26367255165826],\"deg_k_a\":[5.601282368949252,5.596393051699948,5.586527063468881,33.736229448736175],\"deg_k_b\":[125.6012826621372,125.59639334154996,125.58652734762886,153.73623123539997],\"deg_k_c\":[-114.39871916034224,-114.40360847802806,-114.41347446700831,-86.26377034171256],\"deg_k_n\":[-17.653242753591893,-21.464243305268084,-22.42735469584344,91.26367255165826],\"i_j_a_m\":[83.00962378322245,166.0573760982971,249.17871574019952,75.56203311696551],\"i_j_b_m\":[83.00962098459179,166.0573704979105,249.17870734403422,75.56203207568642],\"i_j_c_m\":[83.00962199824286,166.05737255279413,249.17871045409137,75.56203055574177],\"i_j_n_m\":[7.310410226438094e-11,7.037085708863779e-10,1.4647640126882052e-09,2.416432995232007e-13],\"i_k_a_m\":[83.01256692556818,166.06124388771042,249.1825174322575,75.56203311696551],\"i_k_b_m\":[83.01256412104895,166.0612382815214,249.1825090303849,75.56203207568642],\"i_k_c_m\":[83.0125651553539,166.06124035701478,249.1825121609874,75.56203055574177],\"i_k_n_m\":[6.955108463439524e-10,1.4314138506624911e-09,2.19283689791003e-09,2.416432995232007e-13],\"line_id\":[\"W1mv-W2mv\",\"W2mv-W3mv\",\"W3mv-POImv\",\"POI-GRID\"],\"x_s\":[[-1500.0,-1000.0],[-1000.0,-500.0],[-500.0,0.0],[100.0,500.0]],\"y_s\":[[180.0,180.0],[180.0,180.0],[180.0,0.0],[0.0,0.0]]},\"selected\":{\"id\":\"1969\",\"type\":\"Selection\"},\"selection_policy\":{\"id\":\"1970\",\"type\":\"UnionRenderers\"}},\"id\":\"1884\",\"type\":\"ColumnDataSource\"},{\"attributes\":{},\"id\":\"1864\",\"type\":\"WheelZoomTool\"},{\"attributes\":{\"callback\":null,\"data\":{\"deg_1a\":[3.736230569994582,-173.95964009926,-173.9699024742348,-173.9954664156704],\"deg_1b\":[123.7362307795458,-53.959639791886005,-53.96990217363433,-53.99546612884154],\"deg_1c\":[-116.26377100711795,66.0403583814948,66.03009600556352,66.00453206215761],\"deg_1n\":[90.0,90.0,-135.0,0.0],\"deg_2a\":[-146.2637705512643,36.040358475435575,36.03009610445061,36.00453217104436],\"deg_2b\":[-26.263768764600247,156.04036116188666,156.03009878125687,156.00453482835945],\"deg_2c\":[93.73622965828702,-83.95964114697364,-83.96990352801292,-83.99546748175818],\"deg_2n\":[111.80140948635182,-109.74266125733,-109.93863532765846,-110.33907386996142],\"i_1a_m\":[249.3547098125179,83.00962378330799,83.04597186738725,83.11887724663922],\"i_1b_m\":[249.35470136048068,83.00962098462622,83.04596907154742,83.1188744565791],\"i_1c_m\":[249.35470479670167,83.00962199830815,83.0459700921417,83.11887549125429],\"i_1n_m\":[2.2737367544323206e-13,1.1368683772161603e-13,1.6077746776921858e-13,5.684341886080802e-14],\"i_2a_m\":[75.56203311696558,2406.0760250933527,2407.129592913746,2409.242792650724],\"i_2b_m\":[75.56203207568613,2406.0760131532297,2407.1295808472005,2409.2427803236214],\"i_2c_m\":[75.56203055574221,2406.075983963338,2407.129551777494,2409.2427515031222],\"i_2n_m\":[6.12222357532858e-13,6.945481999552893e-05,6.92847353688866e-05,6.894380474767092e-05],\"trafo_id\":[\"POImv-POI\",\"W1mv-W1lv\",\"W2mv-W2lv\",\"W3mv-W3lv\"],\"x_s\":[[0.0,100.0],[-1500.0,-1500.0],[-1000.0,-1000.0],[-500.0,-500.0]],\"y_s\":[[0.0,0.0],[180.0,200.0],[180.0,200.0],[180.0,200.0]]},\"selected\":{\"id\":\"1967\",\"type\":\"Selection\"},\"selection_policy\":{\"id\":\"1968\",\"type\":\"UnionRenderers\"}},\"id\":\"1878\",\"type\":\"ColumnDataSource\"},{\"attributes\":{\"overlay\":{\"id\":\"1871\",\"type\":\"BoxAnnotation\"}},\"id\":\"1865\",\"type\":\"BoxZoomTool\"},{\"attributes\":{},\"id\":\"1849\",\"type\":\"LinearScale\"},{\"attributes\":{},\"id\":\"1866\",\"type\":\"SaveTool\"},{\"attributes\":{},\"id\":\"1966\",\"type\":\"BasicTickFormatter\"},{\"attributes\":{},\"id\":\"1867\",\"type\":\"ResetTool\"},{\"attributes\":{},\"id\":\"1969\",\"type\":\"Selection\"},{\"attributes\":{\"line_alpha\":{\"value\":0.1},\"line_color\":{\"value\":\"#1f77b4\"},\"line_width\":{\"value\":5},\"xs\":{\"field\":\"x_s\"},\"ys\":{\"field\":\"y_s\"}},\"id\":\"1887\",\"type\":\"MultiLine\"},{\"attributes\":{},\"id\":\"1868\",\"type\":\"HelpTool\"}],\"root_ids\":[\"1843\"]},\"title\":\"Bokeh Application\",\"version\":\"1.0.1\"}};\n",
       "  var render_items = [{\"docid\":\"07238305-e8e4-4f42-beb2-9db8c8026a89\",\"roots\":{\"1843\":\"c6b3ba73-347c-4b4e-8ae3-151b8cfa9ab1\"}}];\n",
       "  root.Bokeh.embed.embed_items_notebook(docs_json, render_items);\n",
       "\n",
       "  }\n",
       "  if (root.Bokeh !== undefined) {\n",
       "    embed_document(root);\n",
       "  } else {\n",
       "    var attempts = 0;\n",
       "    var timer = setInterval(function(root) {\n",
       "      if (root.Bokeh !== undefined) {\n",
       "        embed_document(root);\n",
       "        clearInterval(timer);\n",
       "      }\n",
       "      attempts++;\n",
       "      if (attempts > 100) {\n",
       "        console.log(\"Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing\");\n",
       "        clearInterval(timer);\n",
       "      }\n",
       "    }, 10, root)\n",
       "  }\n",
       "})(window);"
      ],
      "application/vnd.bokehjs_exec.v0+json": ""
     },
     "metadata": {
      "application/vnd.bokehjs_exec.v0+json": {
       "id": "1843"
      }
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "V_ref = 1.0\n",
    "p_gen = 3.0e3\n",
    "q_gen = 0\n",
    "\n",
    "data['grid_feeders'][0]['kW'] = p_gen\n",
    "data['grid_feeders'][1]['kW'] = p_gen\n",
    "data['grid_feeders'][2]['kW'] = p_gen\n",
    "\n",
    "grid_1 = grid()\n",
    "grid_1.read(data)  # Load data\n",
    "grid_1.pf() \n",
    "\n",
    "\n",
    "def obj(x):\n",
    "\n",
    "     \n",
    "    data['grid_feeders'][0]['kvar'] = x[0]\n",
    "    data['grid_feeders'][1]['kvar'] = x[1]\n",
    "    data['grid_feeders'][2]['kvar'] = x[2]\n",
    "    data['grid_feeders'][3]['kvar'] = x[3]\n",
    "    grid_1.read(data)  # Load data\n",
    "    grid_1.pf()  # solve power flow    \n",
    "    mon = grid_1.monitor(bus_from='POI', bus_to='GRID')\n",
    "\n",
    "    P_loss = p_gen*3*1000 - mon.P \n",
    "\n",
    "    return P_loss\n",
    "\n",
    "def const1(x):\n",
    "    return 1.02-abs(grid_1.monitor(bus_from='POI', bus_to='GRID').V_a)/38.105/1000\n",
    "    \n",
    "def const2(x):\n",
    "    return -(0.98-abs(grid_1.monitor(bus_from='POI', bus_to='GRID').V_a)/38.105/1000)\n",
    "        \n",
    "\n",
    "res = sopt.minimize(obj,[0,0,0,0], method='COBYLA', \n",
    "                    constraints=[{'type':'ineq','fun':const1},{'type':'ineq','fun':const2}]\n",
    "                   )\n",
    "print(res)\n",
    "\n",
    "p=plot_results(grid_1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "POI active power = 8.807 MW\n",
      "POI reactive power = -0.25 Mvar\n"
     ]
    }
   ],
   "source": [
    "mon = grid_1.monitor(bus_from='POI', bus_to='GRID')\n",
    "print('POI active power = {:0.3f} MW'.format(mon.P/1e6))\n",
    "print('POI reactive power = {:0.2f} Mvar'.format(mon.Q/1e6))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Run this notebook in binder:\n",
    "\n",
    "[![Documentation Status](https://mybinder.org/badge.svg)](https://mybinder.org/v2/gh/pydgrid/pydgrid/master?filepath=/docs/jupyter_notebooks/wind_farm.ipynb)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.1"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
